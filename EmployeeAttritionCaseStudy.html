<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Jon Paugh" />

<meta name="date" content="2019-11-18" />

<title>Case Study 2 - Employee Attrition</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="CLT_2.html">CLT</a>
</li>
<li>
  <a href="BeerAnalysis.html">Craft Beer Case Study</a>
</li>
<li>
  <a href="EmployeeAttritionCaseStudy.html">Employee Attrition Case Study</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Case Study 2 - Employee Attrition</h1>
<h4 class="author">Jon Paugh</h4>
<h4 class="date">11/18/2019</h4>

</div>


<div id="doing-data-science---case-study-2" class="section level2">
<h2>Doing Data Science - Case Study 2</h2>
</div>
<div id="employee-attribution" class="section level2">
<h2>Employee Attribution</h2>
</div>
<div id="original-dataset-httpswww.kaggle.compavansubhashtibm-hr-analytics-attrition-dataset" class="section level2">
<h2>Original dataset <a href="https://www.kaggle.com/pavansubhasht/ibm-hr-analytics-attrition-dataset" class="uri">https://www.kaggle.com/pavansubhasht/ibm-hr-analytics-attrition-dataset</a></h2>
<div id="goal---using-the-subset-of-data-provided-for-training-predict-the-salaries-monthlyincome-and-attribution-attrition-yesno-for-the-two-separate-validation-datasets." class="section level4">
<h4>Goal - using the subset of data provided for training, predict the salaries (MonthlyIncome) and Attribution (Attrition = Yes/No) for the two separate validation datasets.</h4>
</div>
<div id="must-use-either-knn-or-naive-bayes-but-can-use-other-techniques-too" class="section level4">
<h4>Must use either KNN or Naive Bayes, but can use other techniques too</h4>
</div>
</div>
<div id="youtube-video-of-presenation-is-here" class="section level1">
<h1>Youtube video of presenation is here:</h1>
<div id="httpswww.youtube.comwatchvnoikun0tddm" class="section level2">
<h2><a href="https://www.youtube.com/watch?v=noikUN0TdDM" class="uri">https://www.youtube.com/watch?v=noikUN0TdDM</a></h2>
<div id="install-packages" class="section level4">
<h4>Install packages</h4>
<pre class="r"><code>require(&quot;e1071&quot;)
require(&quot;caret&quot;)
require(&quot;corrplot&quot;)
require(&quot;MASS&quot;)
require(&quot;randomForest&quot;)
require(&quot;fields&quot;)
require(&quot;ggthemes&quot;)
require(&quot;ROCR&quot;)
require(&quot;dplyr&quot;)
require(&quot;ggplot2&quot;)
require(&quot;scales&quot;)
require(&quot;grid&quot;)
require(&quot;reshape&quot;)</code></pre>
</div>
</div>
<div id="first-lets-get-our-data-and-see-how-many-rows-we-have." class="section level2">
<h2>First lets get our data and see how many rows we have.</h2>
<div id="note-that-data-at-the-kaggle-project-has-a-total-of-1470-rows-lets-see-if-we-are-dealing-with-the-same-data-set" class="section level4">
<h4>note that data at the kaggle project has a total of 1470 rows, let’s see if we are dealing with the same data set?</h4>
</div>
<div id="we-see-that-we-are-which-means-this-dataset-was-created-probably-by-taking-the-kaggle-dataset-splitting-off-two-300-row-setsets-taking-the-attrition-off-one-of-them-and-taking-the-monthlyincome-off-the-other" class="section level4">
<h4>We see that we are, which means this dataset was created probably by taking the kaggle dataset, splitting off two 300 row setsets, taking the attrition off one of them, and taking the monthlyIncome off the other</h4>
</div>
<div id="one-other-difference-is-that-the-no-salary-and-no-attrition-data-have-an-id-column-added.-not-sure-why-this-was-necessary-since-the-employee-rows-already-contain-an-employee-id-which-should-be-unique-but-thats-fine." class="section level4">
<h4>one other difference is that the No Salary and No Attrition data have an “ID” column added. Not sure why this was necessary since the employee rows already contain an employee ID (which should be unique), but that’s fine.</h4>
<pre class="r"><code>fullTraining = read.csv(&quot;CaseStudy2-data.csv&quot;)
nrowsFullTraining = nrow(fullTraining)

ValidationNoAttrition = read.csv(&quot;CaseStudy2CompSet No Attrition.csv&quot;)
nrowsValidationNoAttrition = nrow(ValidationNoAttrition)
ValidationNoSalary = read.csv(&quot;CaseStudy2CompSet No Salary.csv&quot;)
nrowsValidaitonNoSalary = nrow(ValidationNoSalary)

print(paste(&quot;Number of rows : Full= &quot;,nrowsFullTraining,&quot; ValidationNoAttrition = &quot;,nrowsValidationNoAttrition, &quot; ValidationNoSalary = &quot;, nrowsValidaitonNoSalary))</code></pre>
<pre><code>## [1] &quot;Number of rows : Full=  870  ValidationNoAttrition =  300  ValidationNoSalary =  300&quot;</code></pre>
<pre class="r"><code>print(paste(&quot;Total rows &quot; ,nrowsFullTraining + nrowsValidationNoAttrition + nrowsValidaitonNoSalary ))</code></pre>
<pre><code>## [1] &quot;Total rows  1470&quot;</code></pre>
</div>
</div>
</div>
<div id="lets-try-merging-to-a-single-dataframe-." class="section level1">
<h1>let’s try merging to a single dataframe ….</h1>
<div id="rows" class="section level4">
<h4>1470 rows</h4>
<pre class="r"><code>suppressMessages(library(plyr))

allData &lt;- rbind.fill(fullTraining, ValidationNoAttrition)
allData</code></pre>
<pre><code>##    ID Age Attrition    BusinessTravel DailyRate             Department
## 1   1  32        No     Travel_Rarely       117                  Sales
## 2   2  40        No     Travel_Rarely      1308 Research &amp; Development
## 3   3  35        No Travel_Frequently       200 Research &amp; Development
## 4   4  32        No     Travel_Rarely       801                  Sales
## 5   5  24        No Travel_Frequently       567 Research &amp; Development
## 6   6  27        No Travel_Frequently       294 Research &amp; Development
## 7   7  41        No     Travel_Rarely      1283 Research &amp; Development
## 8   8  37        No     Travel_Rarely       309                  Sales
## 9   9  34        No     Travel_Rarely      1333                  Sales
## 10 10  34        No Travel_Frequently       653 Research &amp; Development
## 11 11  43        No     Travel_Rarely       823 Research &amp; Development
## 12 12  28        No        Non-Travel       280        Human Resources
## 13 13  35        No     Travel_Rarely       950 Research &amp; Development
## 14 14  30        No     Travel_Rarely       202                  Sales
## 15 15  46        No     Travel_Rarely       991        Human Resources
## 16 16  31        No        Non-Travel      1188                  Sales
## 17 17  32        No     Travel_Rarely       498 Research &amp; Development
## 18 18  46        No        Non-Travel      1144 Research &amp; Development
## 19 19  34        No     Travel_Rarely       181 Research &amp; Development
## 20 20  44        No     Travel_Rarely       170 Research &amp; Development
## 21 21  36        No     Travel_Rarely       913 Research &amp; Development
## 22 22  48        No     Travel_Rarely       817                  Sales
## 23 23  43        No Travel_Frequently      1001 Research &amp; Development
## 24 24  31        No Travel_Frequently       715                  Sales
## 25 25  33        No     Travel_Rarely      1069 Research &amp; Development
## 26 26  44        No     Travel_Rarely      1099                  Sales
## 27 27  38        No     Travel_Rarely      1245                  Sales
##    DistanceFromHome Education   EducationField EmployeeCount
## 1                13         4    Life Sciences             1
## 2                14         3          Medical             1
## 3                18         2    Life Sciences             1
## 4                 1         4        Marketing             1
## 5                 2         1 Technical Degree             1
## 6                10         2    Life Sciences             1
## 7                 5         5          Medical             1
## 8                10         4    Life Sciences             1
## 9                10         4    Life Sciences             1
## 10               10         4 Technical Degree             1
## 11                6         3          Medical             1
## 12                1         2    Life Sciences             1
## 13                7         3            Other             1
## 14                2         1 Technical Degree             1
## 15                1         2    Life Sciences             1
## 16               20         2        Marketing             1
## 17                3         4          Medical             1
## 18                7         4          Medical             1
## 19                2         4          Medical             1
## 20                1         4    Life Sciences             1
## 21                9         2          Medical             1
## 22                2         1        Marketing             1
## 23                9         5          Medical             1
## 24                2         4            Other             1
## 25                1         3    Life Sciences             1
## 26                5         3        Marketing             1
## 27               14         3    Life Sciences             1
##    EmployeeNumber EnvironmentSatisfaction Gender HourlyRate JobInvolvement
## 1             859                       2   Male         73              3
## 2            1128                       3   Male         44              2
## 3            1412                       3   Male         60              3
## 4            2016                       3 Female         48              3
## 5            1646                       1 Female         32              3
## 6             733                       4   Male         32              3
## 7            1448                       2   Male         90              4
## 8            1105                       4 Female         88              2
## 9            1055                       3 Female         87              3
## 10           1597                       4   Male         92              2
## 11           1866                       1 Female         81              2
## 12           1858                       3   Male         43              3
## 13            845                       3   Male         59              3
## 14            508                       3   Male         72              3
## 15           1314                       4 Female         44              3
## 16            947                       4 Female         45              3
## 17            966                       3 Female         93              3
## 18            487                       3 Female         30              3
## 19           1755                       4   Male         97              4
## 20           1903                       2   Male         78              4
## 21            699                       2   Male         48              2
## 22            712                       2   Male         56              4
## 23            663                       4   Male         72              3
## 24           1613                       4   Male         54              3
## 25            969                       2 Female         42              2
## 26           1267                       2   Male         88              3
## 27           1582                       3   Male         80              3
##    JobLevel                   JobRole JobSatisfaction MaritalStatus
## 1         2           Sales Executive               4      Divorced
## 2         5         Research Director               3        Single
## 3         3    Manufacturing Director               4        Single
## 4         3           Sales Executive               4       Married
## 5         1        Research Scientist               4        Single
## 6         3    Manufacturing Director               1      Divorced
## 7         1        Research Scientist               3       Married
## 8         2           Sales Executive               4      Divorced
## 9         1      Sales Representative               3       Married
## 10        2 Healthcare Representative               3       Married
## 11        5                   Manager               3       Married
## 12        1           Human Resources               4      Divorced
## 13        3    Manufacturing Director               3        Single
## 14        1      Sales Representative               2       Married
## 15        1           Human Resources               1        Single
## 16        2           Sales Executive               3       Married
## 17        2    Manufacturing Director               1       Married
## 18        2    Manufacturing Director               3       Married
## 19        1        Research Scientist               4       Married
## 20        2 Healthcare Representative               1       Married
## 21        2    Manufacturing Director               2      Divorced
## 22        2           Sales Executive               2       Married
## 23        2     Laboratory Technician               3      Divorced
## 24        2           Sales Executive               1        Single
## 25        2 Healthcare Representative               4        Single
## 26        5                   Manager               2       Married
## 27        2           Sales Executive               2       Married
##    MonthlyIncome MonthlyRate NumCompaniesWorked Over18 OverTime
## 1           4403        9250                  2      Y       No
## 2          19626       17544                  1      Y       No
## 3           9362       19944                  2      Y       No
## 4          10422       24032                  1      Y       No
## 5           3760       17218                  1      Y      Yes
## 6           8793        4809                  1      Y       No
## 7           2127        5561                  2      Y      Yes
## 8           6694       24223                  2      Y      Yes
## 9           2220       18410                  1      Y      Yes
## 10          5063       15332                  1      Y       No
## 11         19392       22539                  7      Y       No
## 12          2706       10494                  1      Y       No
## 13         10221       18869                  3      Y       No
## 14          2476       17434                  1      Y       No
## 15          3423       22957                  6      Y       No
## 16          6932       24406                  1      Y       No
## 17          6725       13554                  1      Y       No
## 18          5258       16044                  2      Y       No
## 19          2932        5586                  0      Y      Yes
## 20          5033        9364                  2      Y       No
## 21          8847       13934                  2      Y      Yes
## 22          8120       18597                  3      Y       No
## 23          5679       19627                  3      Y      Yes
## 24          5332       21602                  7      Y       No
## 25          6949       12291                  0      Y       No
## 26         18213        8751                  7      Y       No
## 27          9924       12355                  0      Y       No
##    PercentSalaryHike PerformanceRating RelationshipSatisfaction
## 1                 11                 3                        3
## 2                 14                 3                        1
## 3                 11                 3                        3
## 4                 19                 3                        3
## 5                 13                 3                        3
## 6                 21                 4                        3
## 7                 12                 3                        1
## 8                 14                 3                        3
## 9                 19                 3                        4
## 10                14                 3                        2
## 11                13                 3                        4
## 12                15                 3                        2
## 13                21                 4                        2
## 14                18                 3                        1
## 15                12                 3                        3
## 16                13                 3                        4
## 17                12                 3                        3
## 18                14                 3                        3
## 19                14                 3                        1
## 20                15                 3                        4
## 21                11                 3                        3
## 22                12                 3                        4
## 23                13                 3                        2
## 24                13                 3                        4
## 25                14                 3                        1
## 26                11                 3                        3
## 27                11                 3                        4
##    StandardHours StockOptionLevel TotalWorkingYears TrainingTimesLastYear
## 1             80                1                 8                     3
## 2             80                0                21                     2
## 3             80                0                10                     2
## 4             80                2                14                     3
## 5             80                0                 6                     2
## 6             80                2                 9                     4
## 7             80                0                 7                     5
## 8             80                3                 8                     5
## 9             80                1                 1                     2
## 10            80                1                 8                     3
## 11            80                0                21                     2
## 12            80                1                 3                     2
## 13            80                0                17                     3
## 14            80                1                 1                     3
## 15            80                0                10                     3
## 16            80                1                 9                     2
## 17            80                1                 8                     2
## 18            80                0                 7                     2
## 19            80                3                 6                     3
## 20            80                1                10                     5
## 21            80                1                13                     2
## 22            80                0                12                     3
## 23            80                1                10                     3
## 24            80                0                10                     3
## 25            80                0                 6                     3
## 26            80                1                26                     5
## 27            80                1                10                     3
##    WorkLifeBalance YearsAtCompany YearsInCurrentRole
## 1                2              5                  2
## 2                4             20                  7
## 3                3              2                  2
## 4                3             14                 10
## 5                3              6                  3
## 6                2              9                  7
## 7                2              4                  2
## 8                3              1                  0
## 9                3              1                  1
## 10               2              8                  2
## 11               3             16                 12
## 12               3              3                  2
## 13               4              8                  5
## 14               3              1                  0
## 15               4              7                  6
## 16               2              9                  8
## 17               4              8                  7
## 18               4              1                  0
## 19               3              5                  0
## 20               3              2                  0
## 21               3              3                  2
## 22               3              2                  2
## 23               3              8                  7
## 24               3              5                  2
## 25               3              5                  0
## 26               3             22                  9
## 27               3              9                  8
##    YearsSinceLastPromotion YearsWithCurrManager
## 1                        0                    3
## 2                        4                    9
## 3                        2                    2
## 4                        5                    7
## 5                        1                    3
## 6                        1                    7
## 7                        0                    3
## 8                        0                    0
## 9                        0                    0
## 10                       7                    7
## 11                       6                   14
## 12                       2                    2
## 13                       1                    6
## 14                       0                    0
## 15                       5                    7
## 16                       0                    0
## 17                       6                    3
## 18                       0                    0
## 19                       1                    2
## 20                       2                    2
## 21                       0                    2
## 22                       2                    2
## 23                       4                    7
## 24                       0                    3
## 25                       1                    4
## 26                       3                   10
## 27                       7                    7
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1143 rows ]</code></pre>
<pre class="r"><code>allData &lt;- rbind.fill(allData, ValidationNoSalary)
allData</code></pre>
<pre><code>##    ID Age Attrition    BusinessTravel DailyRate             Department
## 1   1  32        No     Travel_Rarely       117                  Sales
## 2   2  40        No     Travel_Rarely      1308 Research &amp; Development
## 3   3  35        No Travel_Frequently       200 Research &amp; Development
## 4   4  32        No     Travel_Rarely       801                  Sales
## 5   5  24        No Travel_Frequently       567 Research &amp; Development
## 6   6  27        No Travel_Frequently       294 Research &amp; Development
## 7   7  41        No     Travel_Rarely      1283 Research &amp; Development
## 8   8  37        No     Travel_Rarely       309                  Sales
## 9   9  34        No     Travel_Rarely      1333                  Sales
## 10 10  34        No Travel_Frequently       653 Research &amp; Development
## 11 11  43        No     Travel_Rarely       823 Research &amp; Development
## 12 12  28        No        Non-Travel       280        Human Resources
## 13 13  35        No     Travel_Rarely       950 Research &amp; Development
## 14 14  30        No     Travel_Rarely       202                  Sales
## 15 15  46        No     Travel_Rarely       991        Human Resources
## 16 16  31        No        Non-Travel      1188                  Sales
## 17 17  32        No     Travel_Rarely       498 Research &amp; Development
## 18 18  46        No        Non-Travel      1144 Research &amp; Development
## 19 19  34        No     Travel_Rarely       181 Research &amp; Development
## 20 20  44        No     Travel_Rarely       170 Research &amp; Development
## 21 21  36        No     Travel_Rarely       913 Research &amp; Development
## 22 22  48        No     Travel_Rarely       817                  Sales
## 23 23  43        No Travel_Frequently      1001 Research &amp; Development
## 24 24  31        No Travel_Frequently       715                  Sales
## 25 25  33        No     Travel_Rarely      1069 Research &amp; Development
## 26 26  44        No     Travel_Rarely      1099                  Sales
## 27 27  38        No     Travel_Rarely      1245                  Sales
##    DistanceFromHome Education   EducationField EmployeeCount
## 1                13         4    Life Sciences             1
## 2                14         3          Medical             1
## 3                18         2    Life Sciences             1
## 4                 1         4        Marketing             1
## 5                 2         1 Technical Degree             1
## 6                10         2    Life Sciences             1
## 7                 5         5          Medical             1
## 8                10         4    Life Sciences             1
## 9                10         4    Life Sciences             1
## 10               10         4 Technical Degree             1
## 11                6         3          Medical             1
## 12                1         2    Life Sciences             1
## 13                7         3            Other             1
## 14                2         1 Technical Degree             1
## 15                1         2    Life Sciences             1
## 16               20         2        Marketing             1
## 17                3         4          Medical             1
## 18                7         4          Medical             1
## 19                2         4          Medical             1
## 20                1         4    Life Sciences             1
## 21                9         2          Medical             1
## 22                2         1        Marketing             1
## 23                9         5          Medical             1
## 24                2         4            Other             1
## 25                1         3    Life Sciences             1
## 26                5         3        Marketing             1
## 27               14         3    Life Sciences             1
##    EmployeeNumber EnvironmentSatisfaction Gender HourlyRate JobInvolvement
## 1             859                       2   Male         73              3
## 2            1128                       3   Male         44              2
## 3            1412                       3   Male         60              3
## 4            2016                       3 Female         48              3
## 5            1646                       1 Female         32              3
## 6             733                       4   Male         32              3
## 7            1448                       2   Male         90              4
## 8            1105                       4 Female         88              2
## 9            1055                       3 Female         87              3
## 10           1597                       4   Male         92              2
## 11           1866                       1 Female         81              2
## 12           1858                       3   Male         43              3
## 13            845                       3   Male         59              3
## 14            508                       3   Male         72              3
## 15           1314                       4 Female         44              3
## 16            947                       4 Female         45              3
## 17            966                       3 Female         93              3
## 18            487                       3 Female         30              3
## 19           1755                       4   Male         97              4
## 20           1903                       2   Male         78              4
## 21            699                       2   Male         48              2
## 22            712                       2   Male         56              4
## 23            663                       4   Male         72              3
## 24           1613                       4   Male         54              3
## 25            969                       2 Female         42              2
## 26           1267                       2   Male         88              3
## 27           1582                       3   Male         80              3
##    JobLevel                   JobRole JobSatisfaction MaritalStatus
## 1         2           Sales Executive               4      Divorced
## 2         5         Research Director               3        Single
## 3         3    Manufacturing Director               4        Single
## 4         3           Sales Executive               4       Married
## 5         1        Research Scientist               4        Single
## 6         3    Manufacturing Director               1      Divorced
## 7         1        Research Scientist               3       Married
## 8         2           Sales Executive               4      Divorced
## 9         1      Sales Representative               3       Married
## 10        2 Healthcare Representative               3       Married
## 11        5                   Manager               3       Married
## 12        1           Human Resources               4      Divorced
## 13        3    Manufacturing Director               3        Single
## 14        1      Sales Representative               2       Married
## 15        1           Human Resources               1        Single
## 16        2           Sales Executive               3       Married
## 17        2    Manufacturing Director               1       Married
## 18        2    Manufacturing Director               3       Married
## 19        1        Research Scientist               4       Married
## 20        2 Healthcare Representative               1       Married
## 21        2    Manufacturing Director               2      Divorced
## 22        2           Sales Executive               2       Married
## 23        2     Laboratory Technician               3      Divorced
## 24        2           Sales Executive               1        Single
## 25        2 Healthcare Representative               4        Single
## 26        5                   Manager               2       Married
## 27        2           Sales Executive               2       Married
##    MonthlyIncome MonthlyRate NumCompaniesWorked Over18 OverTime
## 1           4403        9250                  2      Y       No
## 2          19626       17544                  1      Y       No
## 3           9362       19944                  2      Y       No
## 4          10422       24032                  1      Y       No
## 5           3760       17218                  1      Y      Yes
## 6           8793        4809                  1      Y       No
## 7           2127        5561                  2      Y      Yes
## 8           6694       24223                  2      Y      Yes
## 9           2220       18410                  1      Y      Yes
## 10          5063       15332                  1      Y       No
## 11         19392       22539                  7      Y       No
## 12          2706       10494                  1      Y       No
## 13         10221       18869                  3      Y       No
## 14          2476       17434                  1      Y       No
## 15          3423       22957                  6      Y       No
## 16          6932       24406                  1      Y       No
## 17          6725       13554                  1      Y       No
## 18          5258       16044                  2      Y       No
## 19          2932        5586                  0      Y      Yes
## 20          5033        9364                  2      Y       No
## 21          8847       13934                  2      Y      Yes
## 22          8120       18597                  3      Y       No
## 23          5679       19627                  3      Y      Yes
## 24          5332       21602                  7      Y       No
## 25          6949       12291                  0      Y       No
## 26         18213        8751                  7      Y       No
## 27          9924       12355                  0      Y       No
##    PercentSalaryHike PerformanceRating RelationshipSatisfaction
## 1                 11                 3                        3
## 2                 14                 3                        1
## 3                 11                 3                        3
## 4                 19                 3                        3
## 5                 13                 3                        3
## 6                 21                 4                        3
## 7                 12                 3                        1
## 8                 14                 3                        3
## 9                 19                 3                        4
## 10                14                 3                        2
## 11                13                 3                        4
## 12                15                 3                        2
## 13                21                 4                        2
## 14                18                 3                        1
## 15                12                 3                        3
## 16                13                 3                        4
## 17                12                 3                        3
## 18                14                 3                        3
## 19                14                 3                        1
## 20                15                 3                        4
## 21                11                 3                        3
## 22                12                 3                        4
## 23                13                 3                        2
## 24                13                 3                        4
## 25                14                 3                        1
## 26                11                 3                        3
## 27                11                 3                        4
##    StandardHours StockOptionLevel TotalWorkingYears TrainingTimesLastYear
## 1             80                1                 8                     3
## 2             80                0                21                     2
## 3             80                0                10                     2
## 4             80                2                14                     3
## 5             80                0                 6                     2
## 6             80                2                 9                     4
## 7             80                0                 7                     5
## 8             80                3                 8                     5
## 9             80                1                 1                     2
## 10            80                1                 8                     3
## 11            80                0                21                     2
## 12            80                1                 3                     2
## 13            80                0                17                     3
## 14            80                1                 1                     3
## 15            80                0                10                     3
## 16            80                1                 9                     2
## 17            80                1                 8                     2
## 18            80                0                 7                     2
## 19            80                3                 6                     3
## 20            80                1                10                     5
## 21            80                1                13                     2
## 22            80                0                12                     3
## 23            80                1                10                     3
## 24            80                0                10                     3
## 25            80                0                 6                     3
## 26            80                1                26                     5
## 27            80                1                10                     3
##    WorkLifeBalance YearsAtCompany YearsInCurrentRole
## 1                2              5                  2
## 2                4             20                  7
## 3                3              2                  2
## 4                3             14                 10
## 5                3              6                  3
## 6                2              9                  7
## 7                2              4                  2
## 8                3              1                  0
## 9                3              1                  1
## 10               2              8                  2
## 11               3             16                 12
## 12               3              3                  2
## 13               4              8                  5
## 14               3              1                  0
## 15               4              7                  6
## 16               2              9                  8
## 17               4              8                  7
## 18               4              1                  0
## 19               3              5                  0
## 20               3              2                  0
## 21               3              3                  2
## 22               3              2                  2
## 23               3              8                  7
## 24               3              5                  2
## 25               3              5                  0
## 26               3             22                  9
## 27               3              9                  8
##    YearsSinceLastPromotion YearsWithCurrManager
## 1                        0                    3
## 2                        4                    9
## 3                        2                    2
## 4                        5                    7
## 5                        1                    3
## 6                        1                    7
## 7                        0                    3
## 8                        0                    0
## 9                        0                    0
## 10                       7                    7
## 11                       6                   14
## 12                       2                    2
## 13                       1                    6
## 14                       0                    0
## 15                       5                    7
## 16                       0                    0
## 17                       6                    3
## 18                       0                    0
## 19                       1                    2
## 20                       2                    2
## 21                       0                    2
## 22                       2                    2
## 23                       4                    7
## 24                       0                    3
## 25                       1                    4
## 26                       3                   10
## 27                       7                    7
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 1443 rows ]</code></pre>
<pre class="r"><code>nrow(allData)</code></pre>
<pre><code>## [1] 1470</code></pre>
</div>
</div>
<div id="lets-do-some-feature-engineering-based-on-what-is-needed-to-improve-the-attrition-prediction-results-attrition-one-way-or-another" class="section level1">
<h1>let’s do some feature engineering based on what is needed to improve the attrition prediction results (% attrition one way or another)</h1>
<pre class="r"><code>allData$BusinessTravelFrequently = &quot;No&quot;
allData$BusinessTravelFrequently[allData$BusinessTravel==&quot;Travel_Frequently&quot;] &lt;- &quot;Yes&quot;
allData$BusinessTravelFrequently = as.factor(allData$BusinessTravelFrequently)


allData &lt;- allData %&gt;% mutate(LowEducation = case_when(
        Education &gt; 4  ~ &quot;No&quot;,
        Education &lt;= 4  ~ &quot;Yes&quot;))
allData$LowEducation = as.factor(allData$LowEducation)
allData &lt;- allData %&gt;% mutate(LowEnvironmentalSatisfaction = case_when(
        EnvironmentSatisfaction &gt; 3  ~ &quot;No&quot;,
        EnvironmentSatisfaction &lt;= 3  ~ &quot;Yes&quot;))
allData$LowEnvironmentalSatisfaction = as.factor(allData$LowEnvironmentalSatisfaction)
allData &lt;- allData %&gt;% mutate(LowJobLevel = case_when(
        JobLevel == 1  ~ &quot;Yes&quot;,
        JobLevel &gt; 1   ~ &quot;No&quot;))
allData$LowJobLevel = as.factor(allData$LowJobLevel)
allData &lt;- allData %&gt;% mutate(JobRoleSales = case_when(
        JobRole == &quot;Sales Representative&quot;  ~ &quot;Yes&quot;,
        JobLevel != &quot;Sales Representative&quot;   ~ &quot;No&quot;))
allData$JobRoleSales = as.factor(allData$JobRoleSales)
allData &lt;- allData %&gt;% mutate(HighCompaniesWorked = case_when(
        NumCompaniesWorked &gt; 5  ~ &quot;Yes&quot;,
        Education &lt;= 5  ~ &quot;No&quot;))
allData$HighCompaniesWorked = as.factor(allData$HighCompaniesWorked)
allData &lt;- allData %&gt;% mutate(LowWorkLifeBalance = case_when(
        WorkLifeBalance == 1  ~ &quot;Yes&quot;,
        WorkLifeBalance &gt; 1  ~ &quot;No&quot;))
allData$LowWorkLifeBalance = as.factor(allData$LowWorkLifeBalance)
allData &lt;- allData %&gt;% mutate(JobRoleMed = case_when(
        JobRole == &quot;Human Resources&quot;  ~ &quot;Yes&quot;,
        JobRole == &quot;Laboratory Technician&quot;  ~ &quot;Yes&quot;,
        JobRole == &quot;Research Scientist&quot;  ~ &quot;Yes&quot;,
        JobRole == &quot;Sales Executive&quot;  ~ &quot;Yes&quot;,
        TRUE ~ &quot;No&quot;))
allData$JobRoleMed = as.factor(allData$JobRoleMed)


str(allData)</code></pre>
<pre><code>## &#39;data.frame&#39;:    1470 obs. of  44 variables:
##  $ ID                          : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Age                         : int  32 40 35 32 24 27 41 37 34 34 ...
##  $ Attrition                   : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ BusinessTravel              : Factor w/ 3 levels &quot;Non-Travel&quot;,&quot;Travel_Frequently&quot;,..: 3 3 2 3 2 2 3 3 3 2 ...
##  $ DailyRate                   : int  117 1308 200 801 567 294 1283 309 1333 653 ...
##  $ Department                  : Factor w/ 3 levels &quot;Human Resources&quot;,..: 3 2 2 3 2 2 2 3 3 2 ...
##  $ DistanceFromHome            : int  13 14 18 1 2 10 5 10 10 10 ...
##  $ Education                   : int  4 3 2 4 1 2 5 4 4 4 ...
##  $ EducationField              : Factor w/ 6 levels &quot;Human Resources&quot;,..: 2 4 2 3 6 2 4 2 2 6 ...
##  $ EmployeeCount               : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ EmployeeNumber              : int  859 1128 1412 2016 1646 733 1448 1105 1055 1597 ...
##  $ EnvironmentSatisfaction     : int  2 3 3 3 1 4 2 4 3 4 ...
##  $ Gender                      : Factor w/ 2 levels &quot;Female&quot;,&quot;Male&quot;: 2 2 2 1 1 2 2 1 1 2 ...
##  $ HourlyRate                  : int  73 44 60 48 32 32 90 88 87 92 ...
##  $ JobInvolvement              : int  3 2 3 3 3 3 4 2 3 2 ...
##  $ JobLevel                    : int  2 5 3 3 1 3 1 2 1 2 ...
##  $ JobRole                     : Factor w/ 9 levels &quot;Healthcare Representative&quot;,..: 8 6 5 8 7 5 7 8 9 1 ...
##  $ JobSatisfaction             : int  4 3 4 4 4 1 3 4 3 3 ...
##  $ MaritalStatus               : Factor w/ 3 levels &quot;Divorced&quot;,&quot;Married&quot;,..: 1 3 3 2 3 1 2 1 2 2 ...
##  $ MonthlyIncome               : int  4403 19626 9362 10422 3760 8793 2127 6694 2220 5063 ...
##  $ MonthlyRate                 : int  9250 17544 19944 24032 17218 4809 5561 24223 18410 15332 ...
##  $ NumCompaniesWorked          : int  2 1 2 1 1 1 2 2 1 1 ...
##  $ Over18                      : Factor w/ 1 level &quot;Y&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ OverTime                    : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 2 1 2 2 2 1 ...
##  $ PercentSalaryHike           : int  11 14 11 19 13 21 12 14 19 14 ...
##  $ PerformanceRating           : int  3 3 3 3 3 4 3 3 3 3 ...
##  $ RelationshipSatisfaction    : int  3 1 3 3 3 3 1 3 4 2 ...
##  $ StandardHours               : int  80 80 80 80 80 80 80 80 80 80 ...
##  $ StockOptionLevel            : int  1 0 0 2 0 2 0 3 1 1 ...
##  $ TotalWorkingYears           : int  8 21 10 14 6 9 7 8 1 8 ...
##  $ TrainingTimesLastYear       : int  3 2 2 3 2 4 5 5 2 3 ...
##  $ WorkLifeBalance             : int  2 4 3 3 3 2 2 3 3 2 ...
##  $ YearsAtCompany              : int  5 20 2 14 6 9 4 1 1 8 ...
##  $ YearsInCurrentRole          : int  2 7 2 10 3 7 2 0 1 2 ...
##  $ YearsSinceLastPromotion     : int  0 4 2 5 1 1 0 0 0 7 ...
##  $ YearsWithCurrManager        : int  3 9 2 7 3 7 3 0 0 7 ...
##  $ BusinessTravelFrequently    : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 1 2 2 1 1 1 2 ...
##  $ LowEducation                : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 1 2 2 2 ...
##  $ LowEnvironmentalSatisfaction: Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 1 2 1 2 1 ...
##  $ LowJobLevel                 : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 2 1 2 1 2 1 ...
##  $ JobRoleSales                : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 2 1 ...
##  $ HighCompaniesWorked         : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ LowWorkLifeBalance          : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ JobRoleMed                  : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 1 1 2 2 1 2 2 1 1 ...</code></pre>
</div>
<div id="lets-fix-some-variables-that-are-numeric-but-should-be-factors" class="section level1">
<h1>let’s fix some variables that are numeric but should be factors</h1>
<pre class="r"><code>allData$Education &lt;- as.factor(allData$Education)
allData$EnvironmentSatisfaction &lt;- as.factor(allData$EnvironmentSatisfaction)
allData$JobInvolvement &lt;- as.factor(allData$JobInvolvement)
allData$JobLevel &lt;- as.factor(allData$JobInvolvement)
allData$JobSatisfaction &lt;- as.factor(allData$JobSatisfaction)
allData$PerformanceRating &lt;- as.factor(allData$PerformanceRating)
allData$RelationshipSatisfaction &lt;- as.factor(allData$RelationshipSatisfaction)
allData$StockOptionLevel &lt;- as.factor(allData$StockOptionLevel)
allData$WorkLifeBalance &lt;- as.factor(allData$WorkLifeBalance)</code></pre>
</div>
<div id="lets-check-if-our-data-looks-reasonable-and-that-we-are-not-missing-any-fields" class="section level1">
<h1>let’s check if our data looks reasonable and that we are not missing any fields?</h1>
<div id="we-see-that-we-are-missing-300-attrition-and-300-monthly-income---thats-what-we-expect-we-had-separate-dfs-of-just-those-sizes" class="section level4">
<h4>we see that we are missing 300 attrition and 300 monthly income - that’s what we expect (we had separate DF’s of just those sizes)</h4>
</div>
<div id="there-is-no-missing-data-here-yay-one-problem-down." class="section level4">
<h4>There is NO missing data here, yay! One problem down.</h4>
</div>
<div id="there-data-looks-good-some-comments" class="section level3">
<h3>there data looks good, Some comments:</h3>
<div id="educaition-is-a-number-but-maybe-should-be-a-factor" class="section level4">
<h4>Educaition is a number, but maybe should be a factor?</h4>
</div>
<div id="employee-count-is-always-1-useless" class="section level4">
<h4>employee count is always 1? Useless</h4>
</div>
<div id="employee-number-is-an-identfier-and-we-should-not-be-using-it-for-prediction-probably-it-could-indicate-how-long-the-employee-has-been-there-but-that-should-be-covered-elsewhere" class="section level4">
<h4>employee number is an identfier and we should not be using it for prediction probably? It could indicate how long the employee has been there but that should be covered elsewhere</h4>
</div>
<div id="environmental-satisfaction-is-also-a-numeric---could-be-a-factor" class="section level4">
<h4>Environmental satisfaction is also a numeric - could be a factor?</h4>
</div>
<div id="other-fields-that-could-be-factors---jobinvolvement-joblevel-jobsatisfaction" class="section level4">
<h4>Other fields that could be factors - JobInvolvement, JobLevel, JobSatisfaction</h4>
</div>
<div id="what-is-the-difference-between-monthlyincome-and-monthlyrate" class="section level4">
<h4>what is the difference between monthlyIncome and MonthlyRate</h4>
</div>
<div id="what-is-numcompaniesworked-is-this-past-employment-either-way-its-definitely-numeric-not-a-factor" class="section level4">
<h4>WHat is numcompaniesWorked? Is this past employment? Either way it’s definitely numeric not a factor</h4>
</div>
<div id="what-is-stockoptionlevel" class="section level4">
<h4>What is stockOptionLevel?</h4>
</div>
<div id="what-is-worklifebalance-thats-really-odd---how-could-they-even-measure-that-ok" class="section level4">
<h4>What is “WOrkLifeBalance”? That’s really odd - how could they even measure that?!? OK…</h4>
</div>
<div id="years-at-company---also-yearsincurrentrole---are-these-related-to-yearssincelastpromotion" class="section level4">
<h4>YEars at company - also YearsInCurrentRole - are these related to YearsSinceLastPromotion?</h4>
</div>
<div id="i-guess-you-could-be-in-a-different-role-but-not-prompted" class="section level4">
<h4>I guess you could be in a different role, but not prompted</h4>
</div>
<div id="these-years-are-all-somewhate-related" class="section level4">
<h4>these years are all somewhate related</h4>
<pre class="r"><code>str(allData)</code></pre>
<pre><code>## &#39;data.frame&#39;:    1470 obs. of  44 variables:
##  $ ID                          : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Age                         : int  32 40 35 32 24 27 41 37 34 34 ...
##  $ Attrition                   : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ BusinessTravel              : Factor w/ 3 levels &quot;Non-Travel&quot;,&quot;Travel_Frequently&quot;,..: 3 3 2 3 2 2 3 3 3 2 ...
##  $ DailyRate                   : int  117 1308 200 801 567 294 1283 309 1333 653 ...
##  $ Department                  : Factor w/ 3 levels &quot;Human Resources&quot;,..: 3 2 2 3 2 2 2 3 3 2 ...
##  $ DistanceFromHome            : int  13 14 18 1 2 10 5 10 10 10 ...
##  $ Education                   : Factor w/ 5 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 4 3 2 4 1 2 5 4 4 4 ...
##  $ EducationField              : Factor w/ 6 levels &quot;Human Resources&quot;,..: 2 4 2 3 6 2 4 2 2 6 ...
##  $ EmployeeCount               : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ EmployeeNumber              : int  859 1128 1412 2016 1646 733 1448 1105 1055 1597 ...
##  $ EnvironmentSatisfaction     : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 2 3 3 3 1 4 2 4 3 4 ...
##  $ Gender                      : Factor w/ 2 levels &quot;Female&quot;,&quot;Male&quot;: 2 2 2 1 1 2 2 1 1 2 ...
##  $ HourlyRate                  : int  73 44 60 48 32 32 90 88 87 92 ...
##  $ JobInvolvement              : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 3 2 3 3 3 3 4 2 3 2 ...
##  $ JobLevel                    : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 3 2 3 3 3 3 4 2 3 2 ...
##  $ JobRole                     : Factor w/ 9 levels &quot;Healthcare Representative&quot;,..: 8 6 5 8 7 5 7 8 9 1 ...
##  $ JobSatisfaction             : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 4 3 4 4 4 1 3 4 3 3 ...
##  $ MaritalStatus               : Factor w/ 3 levels &quot;Divorced&quot;,&quot;Married&quot;,..: 1 3 3 2 3 1 2 1 2 2 ...
##  $ MonthlyIncome               : int  4403 19626 9362 10422 3760 8793 2127 6694 2220 5063 ...
##  $ MonthlyRate                 : int  9250 17544 19944 24032 17218 4809 5561 24223 18410 15332 ...
##  $ NumCompaniesWorked          : int  2 1 2 1 1 1 2 2 1 1 ...
##  $ Over18                      : Factor w/ 1 level &quot;Y&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ OverTime                    : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 2 1 2 2 2 1 ...
##  $ PercentSalaryHike           : int  11 14 11 19 13 21 12 14 19 14 ...
##  $ PerformanceRating           : Factor w/ 2 levels &quot;3&quot;,&quot;4&quot;: 1 1 1 1 1 2 1 1 1 1 ...
##  $ RelationshipSatisfaction    : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 3 1 3 3 3 3 1 3 4 2 ...
##  $ StandardHours               : int  80 80 80 80 80 80 80 80 80 80 ...
##  $ StockOptionLevel            : Factor w/ 4 levels &quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 2 1 1 3 1 3 1 4 2 2 ...
##  $ TotalWorkingYears           : int  8 21 10 14 6 9 7 8 1 8 ...
##  $ TrainingTimesLastYear       : int  3 2 2 3 2 4 5 5 2 3 ...
##  $ WorkLifeBalance             : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 2 4 3 3 3 2 2 3 3 2 ...
##  $ YearsAtCompany              : int  5 20 2 14 6 9 4 1 1 8 ...
##  $ YearsInCurrentRole          : int  2 7 2 10 3 7 2 0 1 2 ...
##  $ YearsSinceLastPromotion     : int  0 4 2 5 1 1 0 0 0 7 ...
##  $ YearsWithCurrManager        : int  3 9 2 7 3 7 3 0 0 7 ...
##  $ BusinessTravelFrequently    : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 1 2 2 1 1 1 2 ...
##  $ LowEducation                : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 1 2 2 2 ...
##  $ LowEnvironmentalSatisfaction: Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 1 2 1 2 1 ...
##  $ LowJobLevel                 : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 2 1 2 1 2 1 ...
##  $ JobRoleSales                : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 2 1 ...
##  $ HighCompaniesWorked         : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ LowWorkLifeBalance          : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ JobRoleMed                  : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 1 1 2 2 1 2 2 1 1 ...</code></pre>
<pre class="r"><code> sapply(allData, function(x) sum(is.na(x)))</code></pre>
<pre><code>##                           ID                          Age 
##                            0                            0 
##                    Attrition               BusinessTravel 
##                          300                            0 
##                    DailyRate                   Department 
##                            0                            0 
##             DistanceFromHome                    Education 
##                            0                            0 
##               EducationField                EmployeeCount 
##                            0                            0 
##               EmployeeNumber      EnvironmentSatisfaction 
##                            0                            0 
##                       Gender                   HourlyRate 
##                            0                            0 
##               JobInvolvement                     JobLevel 
##                            0                            0 
##                      JobRole              JobSatisfaction 
##                            0                            0 
##                MaritalStatus                MonthlyIncome 
##                            0                          300 
##                  MonthlyRate           NumCompaniesWorked 
##                            0                            0 
##                       Over18                     OverTime 
##                            0                            0 
##            PercentSalaryHike            PerformanceRating 
##                            0                            0 
##     RelationshipSatisfaction                StandardHours 
##                            0                            0 
##             StockOptionLevel            TotalWorkingYears 
##                            0                            0 
##        TrainingTimesLastYear              WorkLifeBalance 
##                            0                            0 
##               YearsAtCompany           YearsInCurrentRole 
##                            0                            0 
##      YearsSinceLastPromotion         YearsWithCurrManager 
##                            0                            0 
##     BusinessTravelFrequently                 LowEducation 
##                            0                            0 
## LowEnvironmentalSatisfaction                  LowJobLevel 
##                            0                            0 
##                 JobRoleSales          HighCompaniesWorked 
##                            0                            0 
##           LowWorkLifeBalance                   JobRoleMed 
##                            0                            0</code></pre>
</div>
</div>
</div>
<div id="rather-than-use-the-original-datasets-as-we-got-them-lets-take-our-data-from-the-combined-dataset-because-that-will-sure-all-the-columns-are-identifical" class="section level1">
<h1>rather than use the original datasets as we got them, let’s take our data from the combined dataset, because that will sure all the columns are identifical</h1>
<pre class="r"><code>train  &lt;- allData[(! is.na(allData$Attrition)) ,]
train &lt;-  train[(! is.na(train$MonthlyIncome )), ]
nrow(train) </code></pre>
<pre><code>## [1] 870</code></pre>
<pre class="r"><code># back to our original 870
predictAttr = allData[ is.na(allData$Attrition ),]
nrow(predictAttr)</code></pre>
<pre><code>## [1] 300</code></pre>
<pre class="r"><code>predictMonthIncome = allData[ is.na(allData$MonthlyIncome),]
nrow(predictMonthIncome)</code></pre>
<pre><code>## [1] 300</code></pre>
<pre class="r"><code>trainAndAttrit =rbind.fill(train, predictAttr) 
trainAndMonthlyIncome = rbind.fill(train, predictMonthIncome)</code></pre>
</div>
<div id="for-reference-here-are-the-columns" class="section level1">
<h1>for reference here are the columns:</h1>
<div id="id" class="section level3">
<h3>1 - ID</h3>
</div>
<div id="age" class="section level3">
<h3>2 - Age</h3>
</div>
<div id="attrition" class="section level3">
<h3>3 - Attrition</h3>
</div>
<div id="business-travel" class="section level3">
<h3>4 - Business Travel</h3>
</div>
<div id="dailyrate" class="section level3">
<h3>5 - DailyRate</h3>
</div>
<div id="department" class="section level3">
<h3>6 - Department</h3>
</div>
<div id="distancefromhome" class="section level3">
<h3>7 - DistanceFromHome</h3>
</div>
<div id="education" class="section level3">
<h3>8 - Education</h3>
</div>
<div id="educationfield" class="section level3">
<h3>9 - EducationField</h3>
</div>
<div id="employee-count" class="section level3">
<h3>10 - Employee Count</h3>
</div>
<div id="employeenumber" class="section level3">
<h3>11 - EmployeeNumber</h3>
</div>
<div id="environmentsatisfaction" class="section level3">
<h3>12 - EnvironmentSatisfaction</h3>
</div>
<div id="gender" class="section level3">
<h3>13 - Gender</h3>
</div>
<div id="hourly-rate" class="section level3">
<h3>14 - Hourly Rate</h3>
</div>
<div id="jobinvolvement" class="section level3">
<h3>15 - JobInvolvement</h3>
</div>
<div id="joblevel" class="section level3">
<h3>16 - JobLevel</h3>
</div>
<div id="job-role" class="section level3">
<h3>17 - Job ROle</h3>
</div>
<div id="job-satisfcation" class="section level3">
<h3>18 - Job Satisfcation</h3>
</div>
<div id="marital-status" class="section level3">
<h3>19 - Marital Status</h3>
</div>
<div id="monthlyincome" class="section level3">
<h3>20 - MonthlyIncome</h3>
</div>
<div id="monthlyrate" class="section level3">
<h3>21 - MonthlyRate</h3>
</div>
<div id="numcompaniesworked" class="section level3">
<h3>22 NumCompaniesWorked</h3>
</div>
<div id="over18" class="section level3">
<h3>23 - Over18</h3>
</div>
<div id="overtime" class="section level3">
<h3>24 - overTime</h3>
</div>
<div id="percentsalaryhike" class="section level3">
<h3>25 - PercentSalaryHike</h3>
</div>
<div id="performancerating" class="section level3">
<h3>26 - PerformanceRating</h3>
</div>
<div id="relationsatisfaction" class="section level3">
<h3>27 - RelationSatisfaction</h3>
</div>
<div id="standardhours" class="section level3">
<h3>28 - standardHours</h3>
</div>
<div id="stockoptionlevel" class="section level3">
<h3>29 - StockOptionlevel</h3>
</div>
<div id="totalworkingyears" class="section level3">
<h3>30 - TotalWorkingYears</h3>
</div>
<div id="trainingtimeslastyear" class="section level3">
<h3>31 - TrainingTimesLastYear</h3>
</div>
<div id="worklifebalance" class="section level3">
<h3>32 - WorkLifeBalance</h3>
</div>
<div id="yearsatcompany" class="section level3">
<h3>33 - YEarsAtCompany</h3>
</div>
<div id="yearsincurrentrole" class="section level3">
<h3>34 - YearsInCurrentRole</h3>
</div>
<div id="yearssincelastpromotion" class="section level3">
<h3>35 - YearsSinceLastPromotion</h3>
</div>
<div id="yearswithcurrmanager--" class="section level3">
<h3>36 - YearsWithCurrManager -</h3>
</div>
</div>
<div id="all-of-these-fields-look-reasonable-to-use-except" class="section level1">
<h1>All of these fields look reasonable to use except :</h1>
</div>
<div id="id-3---attrition-cant-use-the-field-to-predict-itself-10---employee-count-its-always-1-so-why-bother" class="section level1">
<h1>1 - ID, 3 - Attrition (cant use the field to predict itself), 10 - Employee Count (it’s always 1 so why bother),</h1>
</div>
<div id="employeenumber-should-be-a-random---it-could-have-some-usefulness-or-it-could-lead-us-astray-so-lets-try-without" class="section level1">
<h1>11 - EmployeeNumber should be a random # - it could have some usefulness or it could lead us astray so let’s try without</h1>
</div>
<div id="also-the-variables-23---over18-is-always-the-same-value" class="section level1">
<h1>also the variables 23 - Over18 is always the same value…</h1>
</div>
<div id="and-the-variable-28---standardhours-also-has-the-same-value-always" class="section level1">
<h1>and the variable 28 - StandardHours also has the same value always</h1>
<pre class="r"><code># create a list of the fields we want to use taking out the ones we dont
goodToPredictAttr = c(2,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,19,20,21,22,24,25,26,27,29,30,31,32,33,34,35)
attrField = c(3)

head(train[goodToPredictAttr])</code></pre>
<pre><code>##   Age Attrition    BusinessTravel DailyRate             Department
## 1  32        No     Travel_Rarely       117                  Sales
## 2  40        No     Travel_Rarely      1308 Research &amp; Development
## 3  35        No Travel_Frequently       200 Research &amp; Development
## 4  32        No     Travel_Rarely       801                  Sales
## 5  24        No Travel_Frequently       567 Research &amp; Development
## 6  27        No Travel_Frequently       294 Research &amp; Development
##   DistanceFromHome Education   EducationField EmployeeCount
## 1               13         4    Life Sciences             1
## 2               14         3          Medical             1
## 3               18         2    Life Sciences             1
## 4                1         4        Marketing             1
## 5                2         1 Technical Degree             1
## 6               10         2    Life Sciences             1
##   EnvironmentSatisfaction Gender HourlyRate JobInvolvement JobLevel
## 1                       2   Male         73              3        3
## 2                       3   Male         44              2        2
## 3                       3   Male         60              3        3
## 4                       3 Female         48              3        3
## 5                       1 Female         32              3        3
## 6                       4   Male         32              3        3
##                  JobRole JobSatisfaction MaritalStatus MonthlyIncome
## 1        Sales Executive               4      Divorced          4403
## 2      Research Director               3        Single         19626
## 3 Manufacturing Director               4        Single          9362
## 4        Sales Executive               4       Married         10422
## 5     Research Scientist               4        Single          3760
## 6 Manufacturing Director               1      Divorced          8793
##   MonthlyRate NumCompaniesWorked OverTime PercentSalaryHike
## 1        9250                  2       No                11
## 2       17544                  1       No                14
## 3       19944                  2       No                11
## 4       24032                  1       No                19
## 5       17218                  1      Yes                13
## 6        4809                  1       No                21
##   PerformanceRating RelationshipSatisfaction StockOptionLevel
## 1                 3                        3                1
## 2                 3                        1                0
## 3                 3                        3                0
## 4                 3                        3                2
## 5                 3                        3                0
## 6                 4                        3                2
##   TotalWorkingYears TrainingTimesLastYear WorkLifeBalance YearsAtCompany
## 1                 8                     3               2              5
## 2                21                     2               4             20
## 3                10                     2               3              2
## 4                14                     3               3             14
## 5                 6                     2               3              6
## 6                 9                     4               2              9
##   YearsInCurrentRole YearsSinceLastPromotion
## 1                  2                       0
## 2                  7                       4
## 3                  2                       2
## 4                 10                       5
## 5                  3                       1
## 6                  7                       1</code></pre>
</div>
<div id="lets-check-the-correlation-of-our-variables" class="section level1">
<h1>lets check the correlation of our variables</h1>
<div id="this-shows-correlation-between" class="section level3">
<h3>This shows correlation between:</h3>
</div>
<div id="high---mothlyincome-totalworkingyears-age-totalworkingyears-joblevel-totalworkingyears-percentsalaryhike-performancerating-yearsatcompany-yearsatcurrentrole-yearsatcompany-yearswithcurrmanager" class="section level3">
<h3>HIGH - MothlyIncome + TotalWorkingYears, age + TotalWorkingYears, Joblevel + TotalWorkingYears, PercentSalaryHike + PerformanceRating, YearsAtCompany + YearsAtCurrentRole, YearsAtCompany + YearsWithCurrManager</h3>
</div>
<div id="med---age-joblevel-joblevel-yearsatcompany-monthly-income-with-traingtimelastyear-yearsatcompany-yearsincurrentrole-yearssincelastpromotion-yearswithcurrmanager" class="section level3">
<h3>MED - Age + JobLevel, JobLevel + YearsAtCompany , Monthly Income with TraingTimeLastYear, YearsAtCompany, YearsInCurrentRole, YearsSinceLastPromotion, YearsWithCurrManager</h3>
<pre class="r"><code>suppressMessages(library(corrplot))

dataHasMonthlyIncome &lt;- allData %&gt;% filter(!is.na(allData$MonthlyIncome))

numVars &lt;- sapply(dataHasMonthlyIncome, is.numeric)
correlationMatrix &lt;- cor(dataHasMonthlyIncome[,numVars])</code></pre>
<pre><code>## Warning in cor(dataHasMonthlyIncome[, numVars]): the standard deviation is
## zero</code></pre>
<pre class="r"><code># same thing but now with p value

corrplot(correlationMatrix,main=&#39;\nCorrelation Plot with P Values&#39;, type=&quot;upper&quot;, 
         sig.level = 0.05, tl.cex = 0.75, number.cex=1)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code>numVars</code></pre>
<pre><code>##                           ID                          Age 
##                         TRUE                         TRUE 
##                    Attrition               BusinessTravel 
##                        FALSE                        FALSE 
##                    DailyRate                   Department 
##                         TRUE                        FALSE 
##             DistanceFromHome                    Education 
##                         TRUE                        FALSE 
##               EducationField                EmployeeCount 
##                        FALSE                         TRUE 
##               EmployeeNumber      EnvironmentSatisfaction 
##                         TRUE                        FALSE 
##                       Gender                   HourlyRate 
##                        FALSE                         TRUE 
##               JobInvolvement                     JobLevel 
##                        FALSE                        FALSE 
##                      JobRole              JobSatisfaction 
##                        FALSE                        FALSE 
##                MaritalStatus                MonthlyIncome 
##                        FALSE                         TRUE 
##                  MonthlyRate           NumCompaniesWorked 
##                         TRUE                         TRUE 
##                       Over18                     OverTime 
##                        FALSE                        FALSE 
##            PercentSalaryHike            PerformanceRating 
##                         TRUE                        FALSE 
##     RelationshipSatisfaction                StandardHours 
##                        FALSE                         TRUE 
##             StockOptionLevel            TotalWorkingYears 
##                        FALSE                         TRUE 
##        TrainingTimesLastYear              WorkLifeBalance 
##                         TRUE                        FALSE 
##               YearsAtCompany           YearsInCurrentRole 
##                         TRUE                         TRUE 
##      YearsSinceLastPromotion         YearsWithCurrManager 
##                         TRUE                         TRUE 
##     BusinessTravelFrequently                 LowEducation 
##                        FALSE                        FALSE 
## LowEnvironmentalSatisfaction                  LowJobLevel 
##                        FALSE                        FALSE 
##                 JobRoleSales          HighCompaniesWorked 
##                        FALSE                        FALSE 
##           LowWorkLifeBalance                   JobRoleMed 
##                        FALSE                        FALSE</code></pre>
<pre class="r"><code>ageAndYearCars = c(&quot;Age&quot;, &quot;MonthlyIncome&quot;,&quot;TotalWorkingYears&quot;, &quot;YearsAtCompany&quot;, &quot;YearsInCurrentRole&quot;, &quot;YearsSinceLastPromotion&quot;, &quot;YearsWithCurrManager&quot;)
correlationMatrixSomeNumeric &lt;- cor(dataHasMonthlyIncome[,ageAndYearCars])
# same thing but now with p value

corrplot(correlationMatrixSomeNumeric,main=&#39;\nCorrelation Plot with P Values&#39;, type=&quot;upper&quot;, 
         sig.level = 0.05, tl.cex = 0.75, number.cex=1)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
</div>
</div>
<div id="do-some-exploratory-data-analysis-for-the-relationship-between-the-various-variables-and-the-attrition" class="section level1">
<h1>Do some exploratory data analysis for the relationship between the various variables and the attrition</h1>
</div>
<div id="very-significant-columns-department-especially-sales-has-higher" class="section level1">
<h1>very significant columns : Department (especially sales has higher),</h1>
</div>
<div id="somewhat-significant-columns" class="section level1">
<h1>somewhat significant columns</h1>
<pre class="r"><code>library(ggthemes)
ggplot(data=train, aes(train$Attrition)) + 
  geom_bar(aes(y = (..count..)/sum(..count..))) + ylab(&quot;percent&quot;) + theme_economist() + ggtitle(&quot;Histogram of Attrition&quot;) + xlab(&quot;Attrition&quot;) </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data=train, aes(x=&quot;&quot;, y = Attrition, fill=train$Attrition)) + 
  geom_bar(stat=&quot;identity&quot;, width=1, positions = position_fill()) + 
   coord_polar(&quot;y&quot;, start=0) +
  ylab(&quot;percent&quot;) + theme_economist() + ggtitle(&quot;Histogram of Busines Travel&quot;) + xlab(&quot;Busines Travel&quot;) + scale_fill_discrete(name = &quot;Attrition:&quot;) + facet_wrap(train$BusinessTravel)</code></pre>
<pre><code>## Warning: Ignoring unknown parameters: positions</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<pre class="r"><code>ggplot(data=train, aes(x=train$DailyRate, fill=train$Attrition)) + 
  geom_histogram(bins=50) + theme_economist() + ggtitle(&quot;Histogram of Daily Rate&quot;) + xlab(&quot;Daily Rate&quot;) + geom_density(alpha=.3) + scale_fill_discrete(name = &quot;Attrition:&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-9-3.png" width="672" /></p>
<pre class="r"><code>ggplot(data=train, aes(train$Department, fill=train$Attrition)) + 
  geom_bar(aes(y = (..count..)/sum(..count..)), position=&quot;dodge&quot;) + ylab(&quot;percent&quot;) + theme_economist() + ggtitle(&quot;Histogram of Department&quot;) + xlab(&quot;Department&quot;) + scale_fill_discrete(name = &quot;Attrition:&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-9-4.png" width="672" /></p>
<pre class="r"><code>ggplot(data=train, aes(train$Education, fill=train$Attrition)) + 
  geom_bar(aes(y = (..count..)/sum(..count..)), position=&quot;dodge&quot;) + ylab(&quot;percent&quot;) + theme_economist() + ggtitle(&quot;Histogram of Education&quot;) + xlab(&quot;Education&quot;) + scale_fill_discrete(name = &quot;Attrition:&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-9-5.png" width="672" /></p>
</div>
<div id="lets-make-a-nicer-chart-of-just-attrition" class="section level1">
<h1>lets make a nicer chart of just attrition</h1>
<pre class="r"><code>library(plotly)



attritGrouped  &lt;-  trainAndMonthlyIncome %&gt;% group_by(Attrition) %&gt;% tally() %&gt;%
  mutate(percent=round(prop.table(n),2) * 100) %&gt;% 
  ggplot(aes(x=Attrition, y=percent)) + geom_bar(stat=&quot;identity&quot;) + 
geom_text(aes(x=Attrition, y=0.1, label= sprintf(&quot;%.2f%%&quot;, percent)),
            hjust=0.5, vjust=-3, size=4, 
            colour=&quot;white&quot;, fontface=&quot;bold&quot;) + theme_bw() + labs(x=&quot;Employee Attrition&quot;, y=&quot;Percentage&quot;, title=&quot;Employee Attrition Percentage&quot;) +
  theme_economist() 
attritGrouped</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre class="r"><code>attritGrouped  &lt;-  trainAndMonthlyIncome %&gt;% group_by(Attrition) %&gt;% tally()
bp&lt;- ggplot(attritGrouped, aes(x=&quot;&quot;, y=n, fill=Attrition))+
geom_bar(width = 1, stat = &quot;identity&quot;)
pie &lt;- bp + coord_polar(&quot;y&quot;, start=0) 
pie</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
</div>
<div id="try-to-get-a-nice-percentage-facet-wrap" class="section level1">
<h1>try to get a nice percentage facet wrap</h1>
<pre class="r"><code>library(dplyr)
library(datasets)
library(ggplot2)
data(mtcars)
head(mtcars)</code></pre>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<pre class="r"><code># creating a dataframe
df &lt;- dplyr::group_by(mtcars, .dots = c(&#39;cyl&#39;, &#39;am&#39;)) %&gt;%
  dplyr::summarize(counts = n()) %&gt;%
  dplyr::mutate(perc = (counts / sum(counts)) * 100) %&gt;%
  dplyr::arrange(desc(perc))

# preparing the plot
ggplot2::ggplot(df, aes(&#39;&#39;, counts)) +
  geom_col(
    position = &#39;fill&#39;,
    color = &#39;black&#39;,
    width = 1,
    aes(fill = factor(am))
  ) +
  facet_wrap(~cyl, labeller = &quot;label_both&quot;) +
  geom_label(
    aes(label = paste0(round(perc), &quot;%&quot;), group = factor(am)),
    position = position_fill(vjust = 0.5),
    color = &#39;black&#39;,
    size = 5,
    show.legend = FALSE
  ) +
  coord_polar(theta = &quot;y&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-11-1.png" width="672" /> # use fuction to show percentages</p>
<pre class="r"><code>ShowPieChart &lt;- function(columnBy, columnToShow, titleName)
{
  df &lt;- dplyr::group_by(train, .dots = c(columnBy, columnToShow)) %&gt;%
    dplyr::summarize(counts = n()) %&gt;%
    dplyr::mutate(perc = (counts / sum(counts)) * 100) %&gt;%
    dplyr::arrange_(.dots=c(columnBy, columnToShow))
  
  
  # preparing the plot
  ggplot2::ggplot(df, aes(&#39;&#39;, counts)) +
    geom_col(
      position = &#39;fill&#39;,
      color = &#39;black&#39;,
      width = 1,
      aes(fill = Attrition)
    ) +
    ggtitle(titleName) +
    facet_wrap(paste(&quot;~&quot;,columnBy), labeller = &quot;label_both&quot;) +
    geom_label(
      aes(label = paste0(round(perc), &quot;%&quot;), group = &quot;Attrition&quot;),
      position = position_fill(vjust = 0.5),
      color = &#39;black&#39;,
      size = 5,
      show.legend = FALSE
    ) + scale_fill_discrete(name = &quot;Attrition:&quot;) +
    coord_polar(theta = &quot;y&quot;)
}

ShowPieChart(&quot;BusinessTravel&quot;, &quot;Attrition&quot;, &quot;Attrition by Business Travel&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;Department&quot;, &quot;Attrition&quot;, &quot;Attrition by Department&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-2.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;Education&quot;, &quot;Attrition&quot;, &quot;Attrition by Education&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-3.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;EducationField&quot;, &quot;Attrition&quot;, &quot;Attrition by Education Field&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-4.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;EnvironmentSatisfaction&quot;, &quot;Attrition&quot;, &quot;Attrition by Environmental Satisfaction&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-5.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;Gender&quot;, &quot;Attrition&quot;, &quot;Attrition by Gender&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-6.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;JobLevel&quot;, &quot;Attrition&quot;, &quot;Attrition by Job Level&quot; )</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-7.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;JobRole&quot;, &quot;Attrition&quot;, &quot;Attrition by Job Role&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-8.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;JobSatisfaction&quot;, &quot;Attrition&quot;, &quot;Attrition by Job Satisfaction&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-9.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;MaritalStatus&quot;, &quot;Attrition&quot;, &quot;Attrition by Marital Status&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-10.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;NumCompaniesWorked&quot;, &quot;Attrition&quot;, &quot;Attrition by Number of COmpanies WOrked&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-11.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;OverTime&quot;, &quot;Attrition&quot;, &quot;Attritio by Overtime&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-12.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;PerformanceRating&quot;, &quot;Attrition&quot;, &quot;Attrition by Performance Rating&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-13.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;RelationshipSatisfaction&quot;, &quot;Attrition&quot;, &quot;Attrition by Relationship Satisfaction&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-14.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;StockOptionLevel&quot;, &quot;Attrition&quot;, &quot;Attrition by Stock Option Level&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-15.png" width="672" /></p>
<pre class="r"><code>ShowPieChart(&quot;WorkLifeBalance&quot;, &quot;Attrition&quot;, &quot;Attritio by Work Life Balance&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-12-16.png" width="672" /></p>
</div>
<div id="this-is-a-quick-but-not-as-pretty-review-of-the-continuous-variables-by-attrition" class="section level1">
<h1>This is a quick but not as pretty review of the continuous variables by Attrition</h1>
<pre class="r"><code>NiceBoxPlot &lt;- function(columnBy, columnToShow, columnByDesc, columnToShowDesc)
{


ggplot(train, aes(x=train[,columnBy], y=train[,columnToShow])) + geom_boxplot() +
    stat_summary(fun.y=mean, geom=&quot;point&quot;, shape=5, size=4) +
  ggtitle(paste(columnByDesc, &quot;by&quot;,columnToShowDesc)) + xlab(&quot;Attrition&quot;) + ylab(columnToShowDesc) +
  theme_economist()

}

NiceBoxPlot(&quot;Attrition&quot;, &quot;DistanceFromHome&quot;, &quot;Attrition&quot;, &quot;Distance from Home&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre class="r"><code>NiceBoxPlot(&quot;Attrition&quot;, &quot;HourlyRate&quot;, &quot;Attrition&quot;, &quot;Hourly Rate&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-2.png" width="672" /></p>
<pre class="r"><code>NiceBoxPlot(&quot;Attrition&quot;, &quot;MonthlyIncome&quot;, &quot;Attrition&quot;, &quot;Monthly Income&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-3.png" width="672" /></p>
<pre class="r"><code>NiceBoxPlot(&quot;Attrition&quot;, &quot;MonthlyRate&quot;, &quot;Attrition&quot;, &quot;Monthly Rate&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-4.png" width="672" /></p>
<pre class="r"><code>NiceBoxPlot(&quot;Attrition&quot;, &quot;NumCompaniesWorked&quot;, &quot;Attrition&quot;, &quot;Number of Companies Worked&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-5.png" width="672" /></p>
<pre class="r"><code>NiceBoxPlot(&quot;Attrition&quot;, &quot;PercentSalaryHike&quot;, &quot;Attrition&quot;, &quot;Percent Salary Hike&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-6.png" width="672" /></p>
<pre class="r"><code>NiceBoxPlot(&quot;Attrition&quot;, &quot;TotalWorkingYears&quot;, &quot;Attrition&quot;, &quot;Total Working Years&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-7.png" width="672" /></p>
<pre class="r"><code>NiceBoxPlot(&quot;Attrition&quot;, &quot;TrainingTimesLastYear&quot;, &quot;Attrition&quot;, &quot;Training Times Last Year&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-8.png" width="672" /></p>
<pre class="r"><code>NiceBoxPlot(&quot;Attrition&quot;, &quot;YearsAtCompany&quot;, &quot;Attrition&quot;, &quot;Years at Company&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-9.png" width="672" /></p>
<pre class="r"><code>NiceBoxPlot(&quot;Attrition&quot;, &quot;YearsInCurrentRole&quot;, &quot;Attrition&quot;, &quot;Years in Current Role&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-10.png" width="672" /></p>
<pre class="r"><code>NiceBoxPlot(&quot;Attrition&quot;, &quot;YearsSinceLastPromotion&quot;, &quot;Attrition&quot;, &quot;Years since Last Promotion&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-11.png" width="672" /></p>
<pre class="r"><code>NiceBoxPlot(&quot;Attrition&quot;, &quot;YearsWithCurrManager&quot;, &quot;Attrition&quot;, &quot;Years with Current Manager&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-13-12.png" width="672" /></p>
</div>
<div id="lets-do-further-analysis-to-better-understand-what-could-be-causing" class="section level1">
<h1>let’s do further analysis to better understand what could be causing</h1>
<pre class="r"><code># look at job role + job level

p&lt;-ggplot(data=trainAndMonthlyIncome, aes(x=JobRole,y = &quot;&quot;, fill=Attrition)) +
  geom_bar(stat=&quot;identity&quot;) + facet_grid(JobLevel ~ .) + xlab(&quot;Job Level&quot;) + ylab(&quot;Job Role&quot;) + ggtitle(&quot;Attrition by Job level and Job Role&quot;)
p</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code># this scales better if saved to a file
ggsave(&quot;AttritionByJobLevelJobRole.jpg&quot;, plot = p, width = 12, height = 12, units = &quot;in&quot;)

# maybe use dodge to make this smaller?
p = ggplot(trainAndMonthlyIncome, aes(JobRole, fill = Attrition)) +
  geom_bar(position = &quot;dodge2&quot;) + facet_grid(JobLevel ~ .) + 
  ggtitle(&quot;Attrition by Job Level and Job Role&quot;) + xlab(&quot;Job Role&quot;) + ylab(&quot;Count by Job Level&quot;) 
p</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;AttritionByJobLevelJobRoleDodge.jpg&quot;, plot = p, width = 15, height = 8, units = &quot;in&quot;) 


p = ggplot(trainAndMonthlyIncome, aes(JobRole, fill = Attrition)) +
  geom_bar(position = &quot;dodge2&quot;) + facet_grid(OverTime ~ .) + 
  ggtitle(&quot;Attrition by Overtime and Job Role&quot;) + xlab(&quot;Job Role&quot;) + ylab(&quot;Count by Overtime&quot;) 
p</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-14-3.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;AttritionByOvertimeJobRoleDodge.jpg&quot;, plot = p, width = 15, height = 8, units = &quot;in&quot;) 


p = ggplot(trainAndMonthlyIncome, aes(JobRole, fill = Attrition)) +
  geom_bar(position = &quot;dodge2&quot;) + facet_grid(JobSatisfaction ~ .) + 
  ggtitle(&quot;Attrition by Job Satisfaction and Job Role&quot;) + xlab(&quot;Job Satisfaction&quot;) + ylab(&quot;Count by Overtime&quot;) 
p</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-14-4.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;AttritionByJobSatisfactionJobRoleDodge.jpg&quot;, plot = p, width = 15, height = 8, units = &quot;in&quot;) 


# stock option level by job role

p = ggplot(trainAndMonthlyIncome, aes(JobRole, fill = Attrition)) +
  geom_bar(position = &quot;dodge2&quot;) + facet_grid(StockOptionLevel ~ .) + 
  ggtitle(&quot;Attrition by Stock Option Level and Job Role&quot;) + xlab(&quot;Job Role&quot;) + ylab(&quot;Count by Stock Option Level&quot;) 
p</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-14-5.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;AttritionBystockOptionLevelJobRoleDodge.jpg&quot;, plot = p, width = 15, height = 8, units = &quot;in&quot;) </code></pre>
</div>
<div id="lets-start-off-with-naive-bayes-and-predict-attrition" class="section level1">
<h1>Let’s start off with Naive Bayes and predict attrition</h1>
<div id="this-very-basic-model-with-absolutely-nothing-changed-gives-us-85-accuracy-90-sensitivity-and-61-specificity." class="section level2">
<h2>This very basic model with absolutely nothing changed gives us 85% accuracy, 90% sensitivity and 61% specificity.</h2>
</div>
<div id="but-we-dont-know-from-this-what-our-accuracy-is-on-the-validation-data-set-and-61-is-awfully-close-to-60.-would-be-nice-to-increase-this-higher" class="section level2">
<h2>But we dont know from this what our accuracy is on the validation data set, and 61% is awfully close to 60. Would be nice to increase this higher</h2>
<pre class="r"><code>suppressMessages(library(e1071))
suppressMessages(library(caret))


modelBayes = naiveBayes(Attrition~.,data = train[goodToPredictAttr])
#model
result = predict(modelBayes,train[goodToPredictAttr])

# result is our predictions, but we have values on the original, let&#39;s compare to those

CM = confusionMatrix(table(result,train$Attrition), positive=&quot;Yes&quot;)
CM</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##       
## result  No Yes
##    No  670  54
##    Yes  60  86
##                                           
##                Accuracy : 0.869           
##                  95% CI : (0.8447, 0.8907)
##     No Information Rate : 0.8391          
##     P-Value [Acc &gt; NIR] : 0.00809         
##                                           
##                   Kappa : 0.523           
##                                           
##  Mcnemar&#39;s Test P-Value : 0.63958         
##                                           
##             Sensitivity : 0.61429         
##             Specificity : 0.91781         
##          Pos Pred Value : 0.58904         
##          Neg Pred Value : 0.92541         
##              Prevalence : 0.16092         
##          Detection Rate : 0.09885         
##    Detection Prevalence : 0.16782         
##       Balanced Accuracy : 0.76605         
##                                           
##        &#39;Positive&#39; Class : Yes             
## </code></pre>
<pre class="r"><code>str(result)</code></pre>
<pre><code>##  Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 2 1 1 1 2 1 ...</code></pre>
<pre class="r"><code>length(result)</code></pre>
<pre><code>## [1] 870</code></pre>
</div>
</div>
<div id="confusion-matrix-for-naive-bayes" class="section level1">
<h1>confusion matrix for naive bayes</h1>
<pre class="r"><code># and print out a nice confusion matrix

draw_confusion_matrix &lt;- function(cmtrx) {

total &lt;- sum(cmtrx$table)

res &lt;- as.numeric(cmtrx$table)

# Generate color gradients. Palettes come from RColorBrewer.

greenPalette &lt;- c(&quot;#F7FCF5&quot;,&quot;#E5F5E0&quot;,&quot;#C7E9C0&quot;,&quot;#A1D99B&quot;,&quot;#74C476&quot;,&quot;#41AB5D&quot;,&quot;#238B45&quot;,&quot;#006D2C&quot;,&quot;#00441B&quot;)

redPalette &lt;- c(&quot;#FFF5F0&quot;,&quot;#FEE0D2&quot;,&quot;#FCBBA1&quot;,&quot;#FC9272&quot;,&quot;#FB6A4A&quot;,&quot;#EF3B2C&quot;,&quot;#CB181D&quot;,&quot;#A50F15&quot;,&quot;#67000D&quot;)

getColor &lt;- function (greenOrRed = &quot;green&quot;, amount = 0) {

if (amount == 0)

return(&quot;#FFFFFF&quot;)

palette &lt;- greenPalette

if (greenOrRed == &quot;red&quot;)

palette &lt;- redPalette

colorRampPalette(palette)(100)[10 + ceiling(90 * amount / total)]

}

# set the basic layout

layout(matrix(c(1,1,2)))

par(mar=c(2,2,2,2))

plot(c(100, 345), c(300, 450), type = &quot;n&quot;, xlab=&quot;&quot;, ylab=&quot;&quot;, xaxt=&#39;n&#39;, yaxt=&#39;n&#39;)

title(&#39;CONFUSION MATRIX - Training Data&#39;, cex.main=2)

# create the matrix

classes = colnames(cmtrx$table)

rect(150, 430, 240, 370, col=getColor(&quot;green&quot;, res[1]))

text(195, 435, classes[1], cex=1.2)

rect(250, 430, 340, 370, col=getColor(&quot;red&quot;, res[3]))

text(295, 435, classes[2], cex=1.2)

text(125, 370, &#39;Predicted&#39;, cex=1.3, srt=90, font=2)

text(245, 450, &#39;Actual&#39;, cex=1.3, font=2)

rect(150, 305, 240, 365, col=getColor(&quot;red&quot;, res[2]))

rect(250, 305, 340, 365, col=getColor(&quot;green&quot;, res[4]))

text(140, 400, classes[1], cex=1.2, srt=90)

text(140, 335, classes[2], cex=1.2, srt=90)

# add in the cmtrx results

text(195, 400, res[1], cex=1.6, font=2, col=&#39;white&#39;)

text(195, 335, res[2], cex=1.6, font=2, col=&#39;white&#39;)

text(295, 400, res[3], cex=1.6, font=2, col=&#39;white&#39;)

text(295, 335, res[4], cex=1.6, font=2, col=&#39;white&#39;)

# add in the specifics

plot(c(100, 0), c(100, 0), type = &quot;n&quot;, xlab=&quot;&quot;, ylab=&quot;&quot;, main = &quot;DETAILS&quot;, xaxt=&#39;n&#39;, yaxt=&#39;n&#39;)

text(10, 85, names(cmtrx$byClass[1]), cex=1.2, font=2)

text(10, 70, round(as.numeric(cmtrx$byClass[1]), 3), cex=1.2)

text(30, 85, names(cmtrx$byClass[2]), cex=1.2, font=2)

text(30, 70, round(as.numeric(cmtrx$byClass[2]), 3), cex=1.2)

text(50, 85, names(cmtrx$byClass[5]), cex=1.2, font=2)

text(50, 70, round(as.numeric(cmtrx$byClass[5]), 3), cex=1.2)

text(70, 85, names(cmtrx$byClass[6]), cex=1.2, font=2)

text(70, 70, round(as.numeric(cmtrx$byClass[6]), 3), cex=1.2)

text(90, 85, names(cmtrx$byClass[7]), cex=1.2, font=2)

text(90, 70, round(as.numeric(cmtrx$byClass[7]), 3), cex=1.2)

# add in the accuracy information

text(30, 35, names(cmtrx$overall[1]), cex=1.5, font=2)

text(30, 20, round(as.numeric(cmtrx$overall[1]), 3), cex=1.4)

text(70, 35, names(cmtrx$overall[2]), cex=1.5, font=2)

text(70, 20, round(as.numeric(cmtrx$overall[2]), 3), cex=1.4)

}



draw_confusion_matrix(CM)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-16-1.png" width="672" /> # the prior test we created the confusion matrix based on the training data. Let’s so a test/train split and assess</p>
<pre class="r"><code>set.seed(1)
splitPerc = .7
iterations = 50
masterAcc = matrix(nrow = iterations, ncol = 1)
masterSpec = matrix(nrow = iterations, ncol = 1)
masterSens = matrix(nrow = iterations, ncol = 1)

  
for(j in 1:iterations)
{
  trainIndices = sample(1:dim(train)[1],round(splitPerc * nrow(train)))
  trainData = train[trainIndices,]
  testData = train[-trainIndices,]
  modelBayes = naiveBayes(Attrition~.,data = trainData[goodToPredictAttr])
  
  predictAttrBayes = predict(modelBayes, testData)

  CM = confusionMatrix(table(predictAttrBayes, as.factor(testData$Attrition)),positive=&quot;Yes&quot;)
  masterAcc[j,1] = CM$overall[1]
  masterSens[j,1] = CM$byClass[1][[1]] # sensitivity
  masterSpec[j,1] = CM$byClass[2][[1]] # specificity
}

MeanAcc = colMeans(masterAcc)
MeanAcc</code></pre>
<pre><code>## [1] 0.8449808</code></pre>
<pre class="r"><code>MeanSens = colMeans(masterSens)
MeanSens</code></pre>
<pre><code>## [1] 0.5359252</code></pre>
<pre class="r"><code>MeanSpec = colMeans(masterSpec)
MeanSpec</code></pre>
<pre><code>## [1] 0.9057158</code></pre>
</div>
<div id="what-we-really-want-to-do-though-is-use-a-single-variable-for-each-category-for-these-category-variables.-this-page-refers-to-this-as-creatig-a-contrast-matrix" class="section level1">
<h1>What we really want to do though, is use a single variable for each category for these category variables. This page refers to this as creatig a “Contrast Matrix”</h1>
</div>
<div id="httpwww.sthda.comenglisharticles40-regression-analysis163-regression-with-categorical-variables-dummy-coding-essentials-in-r" class="section level1">
<h1><a href="http://www.sthda.com/english/articles/40-regression-analysis/163-regression-with-categorical-variables-dummy-coding-essentials-in-r/" class="uri">http://www.sthda.com/english/articles/40-regression-analysis/163-regression-with-categorical-variables-dummy-coding-essentials-in-r/</a></h1>
</div>
<div id="section" class="section level1">
<h1></h1>
</div>
<div id="first-some-attempts-at-doing-many-comparisons-at-once.-these-work-ok-but-ultimately-are-not-very-high-production-values" class="section level1">
<h1>first some attempts at doing many comparisons at once. These work OK, but ultimately are not very high production values</h1>
<pre class="r"><code>numVars &lt;- sapply(allData, is.numeric)
head(train)</code></pre>
<pre><code>##   ID Age Attrition    BusinessTravel DailyRate             Department
## 1  1  32        No     Travel_Rarely       117                  Sales
## 2  2  40        No     Travel_Rarely      1308 Research &amp; Development
## 3  3  35        No Travel_Frequently       200 Research &amp; Development
## 4  4  32        No     Travel_Rarely       801                  Sales
## 5  5  24        No Travel_Frequently       567 Research &amp; Development
## 6  6  27        No Travel_Frequently       294 Research &amp; Development
##   DistanceFromHome Education   EducationField EmployeeCount EmployeeNumber
## 1               13         4    Life Sciences             1            859
## 2               14         3          Medical             1           1128
## 3               18         2    Life Sciences             1           1412
## 4                1         4        Marketing             1           2016
## 5                2         1 Technical Degree             1           1646
## 6               10         2    Life Sciences             1            733
##   EnvironmentSatisfaction Gender HourlyRate JobInvolvement JobLevel
## 1                       2   Male         73              3        3
## 2                       3   Male         44              2        2
## 3                       3   Male         60              3        3
## 4                       3 Female         48              3        3
## 5                       1 Female         32              3        3
## 6                       4   Male         32              3        3
##                  JobRole JobSatisfaction MaritalStatus MonthlyIncome
## 1        Sales Executive               4      Divorced          4403
## 2      Research Director               3        Single         19626
## 3 Manufacturing Director               4        Single          9362
## 4        Sales Executive               4       Married         10422
## 5     Research Scientist               4        Single          3760
## 6 Manufacturing Director               1      Divorced          8793
##   MonthlyRate NumCompaniesWorked Over18 OverTime PercentSalaryHike
## 1        9250                  2      Y       No                11
## 2       17544                  1      Y       No                14
## 3       19944                  2      Y       No                11
## 4       24032                  1      Y       No                19
## 5       17218                  1      Y      Yes                13
## 6        4809                  1      Y       No                21
##   PerformanceRating RelationshipSatisfaction StandardHours
## 1                 3                        3            80
## 2                 3                        1            80
## 3                 3                        3            80
## 4                 3                        3            80
## 5                 3                        3            80
## 6                 4                        3            80
##   StockOptionLevel TotalWorkingYears TrainingTimesLastYear WorkLifeBalance
## 1                1                 8                     3               2
## 2                0                21                     2               4
## 3                0                10                     2               3
## 4                2                14                     3               3
## 5                0                 6                     2               3
## 6                2                 9                     4               2
##   YearsAtCompany YearsInCurrentRole YearsSinceLastPromotion
## 1              5                  2                       0
## 2             20                  7                       4
## 3              2                  2                       2
## 4             14                 10                       5
## 5              6                  3                       1
## 6              9                  7                       1
##   YearsWithCurrManager BusinessTravelFrequently LowEducation
## 1                    3                       No          Yes
## 2                    9                       No          Yes
## 3                    2                      Yes          Yes
## 4                    7                       No          Yes
## 5                    3                      Yes          Yes
## 6                    7                      Yes          Yes
##   LowEnvironmentalSatisfaction LowJobLevel JobRoleSales
## 1                          Yes          No           No
## 2                          Yes          No           No
## 3                          Yes          No           No
## 4                          Yes          No           No
## 5                          Yes         Yes           No
## 6                           No          No           No
##   HighCompaniesWorked LowWorkLifeBalance JobRoleMed
## 1                  No                 No        Yes
## 2                  No                 No         No
## 3                  No                 No         No
## 4                  No                 No        Yes
## 5                  No                 No        Yes
## 6                  No                 No         No</code></pre>
<pre class="r"><code>caret::featurePlot(x = train[,c(2,5,7)], y = train$MonthlyIncome, plot=&quot;pairs&quot;, auto.key = list(columns=3))</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code># this is interesting but it&#39;s just too small and hard to modify the labels
suppressMessages(library(tidyr))
suppressMessages(library(dplyr))

notNumeric &lt;- function(x)
{
    ! is.numeric(x)
}


select_if(train,is.numeric) %&gt;%
  gather(-MonthlyIncome, key = &quot;var&quot;, value = &quot;value&quot;) %&gt;% 
  ggplot(aes(x = value, y = MonthlyIncome)) +
    geom_point() +
    facet_wrap(~ var, scales = &quot;free&quot;) +
    theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-18-2.png" width="672" /></p>
</div>
<div id="analysis-at-a-field-by-field-level" class="section level1">
<h1>analysis at a field by field level</h1>
<pre class="r"><code># business travel
suppressMessages(library(ggplot2))
suppressMessages(library(ggthemes))

fill &lt;- &quot;#4271AE&quot;
line &lt;- &quot;#1F3552&quot;

ggplot(data=trainAndAttrit, aes(trainAndAttrit$MonthlyIncome)) + 
  geom_histogram() + theme_economist() + ggtitle(&quot;Histogram of Monthly Income&quot;) + xlab(&quot;Monthly Income&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre class="r"><code>paste(&quot;Mean monthly income is:&quot;,mean(trainAndAttrit$MonthlyIncome))</code></pre>
<pre><code>## [1] &quot;Mean monthly income is: 6573.11965811966&quot;</code></pre>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=Age, y=MonthlyIncome), xlab=&quot;Age&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Age vs Monthly Income&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-2.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = BusinessTravel, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Business Travel&quot;) +
        ggtitle(&quot;Boxplot of Business Travel&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-3.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=DailyRate, y=MonthlyIncome), xlab=&quot;Daily Rate&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Daily Rate&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-4.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = Department, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Department&quot;) +
        ggtitle(&quot;Boxplot of Department&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-5.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=DistanceFromHome, y=MonthlyIncome), xlab=&quot;Distance From Home&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Distance From Home&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-6.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = EducationField, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Eduction Field&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by  Eduction Field&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-7.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = Education, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Eduction&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by  Education&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-8.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = EnvironmentSatisfaction, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Environmental Satisfaction&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by Environmental Satisfaction&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-9.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = Gender, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Gender&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by Gender&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-10.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=HourlyRate, y=MonthlyIncome), xlab=&quot;Hourly Rate&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Hourly Rate&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-11.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = JobInvolvement, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Job Involvement&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by Job Involvement&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-12.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = JobLevel, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Job Level&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by Job Level&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-13.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = JobSatisfaction, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Job Satisfaction&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by Job Satisfaction&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-14.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = MaritalStatus, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Marital Status&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by Marital Status&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-15.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=MonthlyRate, y=MonthlyIncome), xlab=&quot;Monthly Rate&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Monthly Rate&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-16.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=NumCompaniesWorked, y=MonthlyIncome), xlab=&quot;Number of Companies Worked&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Number of Companies Worked&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-17.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = OverTime, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Overtime&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by overtime&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-18.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=PercentSalaryHike, y=MonthlyIncome), xlab=&quot;Percentage Salary Hike&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Percentage Salary Hike&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-19.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = PerformanceRating, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Performance Rating&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by Performance Rating&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-20.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = RelationshipSatisfaction, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Relationship Satisfaction&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by Relationship Satisfaction&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-21.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = StockOptionLevel, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Stock Option Level&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by Stock Level&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-22.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=TotalWorkingYears, y=MonthlyIncome), xlab=&quot;Total Working Years&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Total Working Years&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-23.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=TrainingTimesLastYear, y=MonthlyIncome), xlab=&quot;Training Times Last Year&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Training Times Last Year&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : pseudoinverse used at 2</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : neighborhood radius 1</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : reciprocal condition number 0</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : There are other near singularities as well. 1</code></pre>
<pre><code>## Warning in predLoess(object$y, object$x, newx = if
## (is.null(newdata)) object$x else if (is.data.frame(newdata))
## as.matrix(model.frame(delete.response(terms(object)), : pseudoinverse used
## at 2</code></pre>
<pre><code>## Warning in predLoess(object$y, object$x, newx = if
## (is.null(newdata)) object$x else if (is.data.frame(newdata))
## as.matrix(model.frame(delete.response(terms(object)), : neighborhood radius
## 1</code></pre>
<pre><code>## Warning in predLoess(object$y, object$x, newx = if
## (is.null(newdata)) object$x else if (is.data.frame(newdata))
## as.matrix(model.frame(delete.response(terms(object)), : reciprocal
## condition number 0</code></pre>
<pre><code>## Warning in predLoess(object$y, object$x, newx = if
## (is.null(newdata)) object$x else if (is.data.frame(newdata))
## as.matrix(model.frame(delete.response(terms(object)), : There are other
## near singularities as well. 1</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-24.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x = WorkLifeBalance, y = MonthlyIncome)) +
        geom_boxplot() +
        scale_y_continuous(name = &quot;Monthly Income&quot;) +
        scale_x_discrete(name = &quot;Work Life Balance&quot;) +
        ggtitle(&quot;Boxplot Monthly Income by Work Life Balance&quot;) +
        theme_economist() </code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-25.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=YearsAtCompany, y=MonthlyIncome), xlab=&quot;Years at Company&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Years at Company&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-26.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=YearsInCurrentRole, y=MonthlyIncome), xlab=&quot;Years in Current Role&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Years in Current Role&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-27.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=YearsSinceLastPromotion, y=MonthlyIncome), xlab=&quot;Years since Last Promotion&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Years since Last Promotion&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-28.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=YearsWithCurrManager, y=MonthlyIncome), xlab=&quot;Years with Current Manager&quot;, ylab=&quot;Monthly Income&quot;) + ggtitle(&quot;Monthly Income vs Years with Current Manager&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-29.png" width="672" /></p>
<pre class="r"><code># let&#39;s check correlation between all these year variables

ageRelated = c(2, 20,30, 33, 34, 35, 36)
pairs(train[,ageRelated], pch=19)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-30.png" width="672" /></p>
<pre class="r"><code>ggplot(trainAndAttrit, aes(x=NumCompaniesWorked, y=TotalWorkingYears), xlab=&quot;Number of COmpanies Worked&quot;, ylab=&quot;Total Working Years&quot;) + ggtitle(&quot;Number of Companies Worked vs Total Working Years&quot;) + xlab(&quot;Number of Companies Worked&quot;) + ylab(&quot;Total Working Years&quot;) + geom_point() + geom_smooth(method=loess) + theme_economist()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-19-31.png" width="672" /> ## analysis results: #### Overall the most correlated fields are : Department, Education, NumCompaniesWorked, StockOptionLevel, TotalWorkingYears, YearsAtCompany (strongly correlated with TotalWorkingYears), YearsInCurrentRole (strongly correlated with TotalWorkingYears), YearsSinceLastPromotion(strongly correlated with TotalWorkingYears), YearsWithCurrentManager( stringly correlated with TotalWorkingYears), Age ( strongly correlated with all the Year field as well. It could be that age is a better choice vs TotalWorkingYears) #### Other considerations : Gender, Marital Status, PercentageSalaryHike (non-linear), PerformanceRating, RelationshipSatisfaction(low), WorkLifeBalance(1 is different) #### not sure what mothlyrate field indicates. It has a non-linear relationship with MonthlyIncome, and it does not appear overly strong # it’s intereting the NumCompaniesWorked does not correlate more with TotalWorkingYears. It does for employees with &lt; 2.5 companies. But after that it’s pretty flat!</p>
</div>
<div id="linear-model" class="section level1">
<h1>linear model</h1>
<div id="minimum-goal-is-to-get-rmse-3000-on-both-the-training-and-the-validation-set" class="section level4">
<h4>minimum goal is to get RMSE &lt; 3000 on both the training and the validation set</h4>
</div>
<div id="after-much-trial-and-error-with-combinations" class="section level4">
<h4>After much trial and error with combinations</h4>
<pre class="r"><code># Function that returns Root Mean Squared Error
rmse &lt;- function(error)
{
    sqrt(mean(error^2))
}

## since this model does NOT use the attrition field, let&#39;s include the data for the employees where we are trying to determine attrition too
trainAndAttrit =rbind.fill(train, predictAttr) 


# linear model (after trying many combinations and ruling out variables that failed to improve RMSE and/or had high P values)
linearMod &lt;- lm(trainAndAttrit$MonthlyIncome~Age + JobRole + Department + PerformanceRating + WorkLifeBalance + YearsAtCompany, data=trainAndAttrit)
# 
summary(linearMod)</code></pre>
<pre><code>## 
## Call:
## lm(formula = trainAndAttrit$MonthlyIncome ~ Age + JobRole + Department + 
##     PerformanceRating + WorkLifeBalance + YearsAtCompany, data = trainAndAttrit)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6000.7 -1225.8  -154.8   998.7  6609.7 
## 
## Coefficients:
##                                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                       4536.962    752.437   6.030 2.21e-09 ***
## Age                                 59.730      6.663   8.964  &lt; 2e-16 ***
## JobRoleHuman Resources           -3889.820    729.640  -5.331 1.17e-07 ***
## JobRoleLaboratory Technician     -3739.670    224.833 -16.633  &lt; 2e-16 ***
## JobRoleManager                    8513.764    355.195  23.969  &lt; 2e-16 ***
## JobRoleManufacturing Director      -58.057    247.519  -0.235   0.8146    
## JobRoleResearch Director          8017.147    287.928  27.844  &lt; 2e-16 ***
## JobRoleResearch Scientist        -3757.595    220.849 -17.014  &lt; 2e-16 ***
## JobRoleSales Executive            -332.455    492.103  -0.676   0.4994    
## JobRoleSales Representative      -3796.217    537.467  -7.063 2.81e-12 ***
## DepartmentResearch &amp; Development  -541.770    631.147  -0.858   0.3909    
## DepartmentSales                   -625.344    645.685  -0.968   0.3330    
## PerformanceRating4                -273.536    150.438  -1.818   0.0693 .  
## WorkLifeBalance2                   510.874    260.756   1.959   0.0503 .  
## WorkLifeBalance3                   463.758    245.145   1.892   0.0588 .  
## WorkLifeBalance4                   144.179    286.823   0.503   0.6153    
## YearsAtCompany                     105.031      9.674  10.857  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1841 on 1153 degrees of freedom
## Multiple R-squared:  0.8547, Adjusted R-squared:  0.8526 
## F-statistic: 423.7 on 16 and 1153 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code># now use it to predict the salary


predictMonthlyIncomeResults = predict(linearMod, trainAndAttrit, inverval=&quot;predict&quot;)

error &lt;- trainAndAttrit$MonthlyIncome - predictMonthlyIncomeResults
rmse = rmse(error)
rmse</code></pre>
<pre><code>## [1] 1827.259</code></pre>
</div>
</div>
<div id="use-the-model-to-predict-with-our-validation-data." class="section level1">
<h1>Use the model to predict with our validation data.</h1>
</div>
<div id="then-take-the-output-of-the-prior-linear-regression-based-approach-to-predicting-the-monthlyincome-and-write-out-to-seperate-files-one-file-by-id-and-another-file-by-employee-number" class="section level1">
<h1>Then take the output of the prior linear regression based approach to predicting the monthlyIncome and write out to seperate files, one file by ID and another file by employee number</h1>
<pre class="r"><code>#predictMonthIncome

predictMonthlyIncomeResultsValidation = predict(linearMod, predictMonthIncome, inverval=&quot;predict&quot;)

# create a separate dataset with attrition filled in to avoid future confusion
predictMonthlyIncomeFilledIn = predictMonthIncome
# use the predicted values


predictMonthlyIncomeFilledIn$MonthlyIncome = predictMonthlyIncomeResultsValidation
predictMonthlyIncomeWithID = predictMonthlyIncomeFilledIn[, c(&quot;ID&quot;, &quot;MonthlyIncome&quot;)]


write.csv(predictMonthlyIncomeWithID, file=&quot;Case2PredictionsPaugh Salary.csv&quot;, row.names=FALSE)
predictMonthlyIncomeWithEmployeeNumber = predictMonthlyIncomeFilledIn[, c(&quot;EmployeeNumber&quot;, &quot;MonthlyIncome&quot;)]
write.csv(predictMonthlyIncomeWithEmployeeNumber, file=&quot;Case2PredictionsByENMonthlyIncome.csv&quot;, row.names=FALSE)</code></pre>
</div>
<div id="this-shows-using-the-linear-model-with-a-separate-train-and-test-dataset-and-gives-an-idea-of-the-resulting-confusion-matrix-results" class="section level1">
<h1>this shows using the linear model with a separate train and test dataset and gives an idea of the resulting confusion matrix results</h1>
<pre class="r"><code># Function that returns Root Mean Squared Error
rmse &lt;- function(error)
{
    sqrt(mean(error^2))
}

## since this model does NOT use the attrition field, let&#39;s include the data for the employees where we are trying to determine attrition too



set.seed(1)
splitPerc = .7
iterations = 500
masterRMSE = matrix(nrow = iterations, 1)

  
for(j in 1:iterations)
{
  trainIndices = sample(1:dim(trainAndAttrit)[1],round(splitPerc * nrow(trainAndAttrit)))
  trainData = trainAndAttrit[trainIndices,]
  testData = trainAndAttrit[-trainIndices,]


  # linear model (after trying many combinations and ruling out variables that failed to improve RMSE and/or had high P values)
  linearMod &lt;- lm(trainData$MonthlyIncome~Age + JobRole + Department + PerformanceRating + WorkLifeBalance + YearsAtCompany, data=trainData)
  # 
  summary(linearMod)
  # now use it to predict the salary
  
  
  predictMonthlyIncomeResults = predict(linearMod, testData, inverval=&quot;predict&quot;)
  
  error &lt;- testData$MonthlyIncome - predictMonthlyIncomeResults
  masterRMSE[j,1] = rmse(error)
}

meanRMSE = colMeans(masterRMSE)
meanRMSE</code></pre>
<pre><code>## [1] 1868.258</code></pre>
</div>
<div id="lets-try-using-mass-to-automatically-find-a-model-for-us" class="section level1">
<h1>let’s try using MASS to automatically find a model for us</h1>
<div id="this-produces-very-similar-results-to-manually-searching-for-a-model.-and-gets-almost-the-exact-same-rmse-as-the-manually" class="section level4">
<h4>This produces very similar results to manually searching for a model. And gets almost the exact same RMSE as the manually</h4>
</div>
<div id="created-model-above." class="section level4">
<h4>created model above.</h4>
<pre class="r"><code># Function that returns Root Mean Squared Error
rmse &lt;- function(error)
{
    sqrt(mean(error^2))
}

# remove attrition - tried it initially WITH attrition and the train dataset and it does not use attrition, so removing it here is reasonable
includeForAuto = c(2,4,5,6,7,8,9,12, 13,14,15,16,17,18,19,20,21,22,24,25,26,27,28,29.30,31,32,33,34,35,36)

suppressMessages(library(MASS))
# Fit the full model 
full.model &lt;- lm(MonthlyIncome ~., data = trainAndAttrit[,includeForAuto])
# Stepwise regression model
step.model &lt;- stepAIC(full.model, direction = &quot;both&quot;, trace = FALSE)
summary(step.model)</code></pre>
<pre><code>## 
## Call:
## lm(formula = MonthlyIncome ~ Age + BusinessTravel + DailyRate + 
##     Gender + JobInvolvement + JobRole + NumCompaniesWorked + 
##     OverTime + PerformanceRating + WorkLifeBalance + YearsAtCompany + 
##     YearsSinceLastPromotion + YearsWithCurrManager, data = trainAndAttrit[, 
##     includeForAuto])
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5511.3 -1210.5  -164.2  1031.4  6865.5 
## 
## Coefficients:
##                                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                      3634.5236   481.2996   7.551 8.77e-14 ***
## Age                                50.1541     6.9048   7.264 6.95e-13 ***
## BusinessTravelTravel_Frequently   531.8727   204.9612   2.595  0.00958 ** 
## BusinessTravelTravel_Rarely       367.7609   174.1457   2.112  0.03492 *  
## DailyRate                           0.2244     0.1329   1.688  0.09171 .  
## GenderMale                        170.3765   109.4411   1.557  0.11980    
## JobInvolvement2                  -176.7260   246.1358  -0.718  0.47290    
## JobInvolvement3                  -404.8020   233.8240  -1.731  0.08368 .  
## JobInvolvement4                  -476.3376   281.0979  -1.695  0.09043 .  
## JobRoleHuman Resources          -3286.7355   358.8907  -9.158  &lt; 2e-16 ***
## JobRoleLaboratory Technician    -3697.3846   222.2179 -16.639  &lt; 2e-16 ***
## JobRoleManager                   8555.3943   280.6907  30.480  &lt; 2e-16 ***
## JobRoleManufacturing Director      27.1115   244.8113   0.111  0.91184    
## JobRoleResearch Director         8073.1012   284.8015  28.346  &lt; 2e-16 ***
## JobRoleResearch Scientist       -3715.7878   217.8012 -17.060  &lt; 2e-16 ***
## JobRoleSales Executive           -372.4237   211.6003  -1.760  0.07867 .  
## JobRoleSales Representative     -3839.9453   299.9984 -12.800  &lt; 2e-16 ***
## NumCompaniesWorked                 91.9624    23.4026   3.930 9.02e-05 ***
## OverTimeYes                       167.4848   117.7383   1.423  0.15515    
## PerformanceRating4               -248.5127   148.2576  -1.676  0.09397 .  
## WorkLifeBalance2                  548.6257   257.1397   2.134  0.03309 *  
## WorkLifeBalance3                  522.5860   241.6950   2.162  0.03081 *  
## WorkLifeBalance4                  136.4339   282.5710   0.483  0.62931    
## YearsAtCompany                    120.7798    15.8885   7.602 6.07e-14 ***
## YearsSinceLastPromotion            58.1667    21.0402   2.765  0.00579 ** 
## YearsWithCurrManager              -52.5718    23.5779  -2.230  0.02596 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1811 on 1144 degrees of freedom
## Multiple R-squared:  0.8604, Adjusted R-squared:  0.8573 
## F-statistic: 281.9 on 25 and 1144 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>predictMonthlyIncomeResultsAIC = predict(linearMod, trainAndAttrit, inverval=&quot;predict&quot;)

error &lt;- trainAndAttrit$MonthlyIncome - predictMonthlyIncomeResultsAIC
rmse = rmse(error)
rmse</code></pre>
<pre><code>## [1] 1831.646</code></pre>
</div>
</div>
<div id="lets-try-a-random-forest-for-predicting-attrition" class="section level1">
<h1>let’s try a random forest for predicting attrition</h1>
<div id="this-generates-an-rmse" class="section level4">
<h4>This generates an RMSE</h4>
<pre class="r"><code>library(randomForest)
suppressMessages(library(e1071))
suppressMessages(library(caret))


rmse &lt;- function(error)
{
    sqrt(mean(error^2))
}

set.seed(71)
includeForRF = c(2,3,4,5,6,7,8,9,12, 13,14,15,16,17,18,19,20,21,22,24,25,26,27,28,29.30,31,32,33,34,35,36)

rfModel &lt;- randomForest(Attrition ~ ., data=train[,includeForRF], ntree=500, importance=TRUE,
                        proximity=TRUE)

summary(rfModel)</code></pre>
<pre><code>##                 Length Class  Mode     
## call                 6 -none- call     
## type                 1 -none- character
## predicted          870 factor numeric  
## err.rate          1500 -none- numeric  
## confusion            6 -none- numeric  
## votes             1740 matrix numeric  
## oob.times          870 -none- numeric  
## classes              2 -none- character
## importance         120 -none- numeric  
## importanceSD        90 -none- numeric  
## localImportance      0 -none- NULL     
## proximity       756900 -none- numeric  
## ntree                1 -none- numeric  
## mtry                 1 -none- numeric  
## forest              14 -none- list     
## y                  870 factor numeric  
## test                 0 -none- NULL     
## inbag                0 -none- NULL     
## terms                3 terms  call</code></pre>
<pre class="r"><code>predictAttritionRF = predict(rfModel, train)


CM = confusionMatrix(table(predictAttritionRF,train$Attrition),positive=&quot;Yes&quot;)
CM</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##                   
## predictAttritionRF  No Yes
##                No  730   0
##                Yes   0 140
##                                      
##                Accuracy : 1          
##                  95% CI : (0.9958, 1)
##     No Information Rate : 0.8391     
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16  
##                                      
##                   Kappa : 1          
##                                      
##  Mcnemar&#39;s Test P-Value : NA         
##                                      
##             Sensitivity : 1.0000     
##             Specificity : 1.0000     
##          Pos Pred Value : 1.0000     
##          Neg Pred Value : 1.0000     
##              Prevalence : 0.1609     
##          Detection Rate : 0.1609     
##    Detection Prevalence : 0.1609     
##       Balanced Accuracy : 1.0000     
##                                      
##        &#39;Positive&#39; Class : Yes        
## </code></pre>
</div>
</div>
<div id="show-random-forest-confusion-matrix" class="section level1">
<h1>Show Random Forest Confusion Matrix</h1>
<pre class="r"><code># write out the naive bayes results



draw_confusion_matrix &lt;- function(cmtrx) {

total &lt;- sum(cmtrx$table)

res &lt;- as.numeric(cmtrx$table)

# Generate color gradients. Palettes come from RColorBrewer.

greenPalette &lt;- c(&quot;#F7FCF5&quot;,&quot;#E5F5E0&quot;,&quot;#C7E9C0&quot;,&quot;#A1D99B&quot;,&quot;#74C476&quot;,&quot;#41AB5D&quot;,&quot;#238B45&quot;,&quot;#006D2C&quot;,&quot;#00441B&quot;)

redPalette &lt;- c(&quot;#FFF5F0&quot;,&quot;#FEE0D2&quot;,&quot;#FCBBA1&quot;,&quot;#FC9272&quot;,&quot;#FB6A4A&quot;,&quot;#EF3B2C&quot;,&quot;#CB181D&quot;,&quot;#A50F15&quot;,&quot;#67000D&quot;)

getColor &lt;- function (greenOrRed = &quot;green&quot;, amount = 0) {

if (amount == 0)

return(&quot;#FFFFFF&quot;)

palette &lt;- greenPalette

if (greenOrRed == &quot;red&quot;)

palette &lt;- redPalette

colorRampPalette(palette)(100)[10 + ceiling(90 * amount / total)]

}

# set the basic layout

layout(matrix(c(1,1,2)))

par(mar=c(2,2,2,2))

plot(c(100, 345), c(300, 450), type = &quot;n&quot;, xlab=&quot;&quot;, ylab=&quot;&quot;, xaxt=&#39;n&#39;, yaxt=&#39;n&#39;)

title(&#39;CONFUSION MATRIX - Training Data&#39;, cex.main=2)

# create the matrix

classes = colnames(cmtrx$table)

rect(150, 430, 240, 370, col=getColor(&quot;green&quot;, res[1]))

text(195, 435, classes[1], cex=1.2)

rect(250, 430, 340, 370, col=getColor(&quot;red&quot;, res[3]))

text(295, 435, classes[2], cex=1.2)

text(125, 370, &#39;Predicted&#39;, cex=1.3, srt=90, font=2)

text(245, 450, &#39;Actual&#39;, cex=1.3, font=2)

rect(150, 305, 240, 365, col=getColor(&quot;red&quot;, res[2]))

rect(250, 305, 340, 365, col=getColor(&quot;green&quot;, res[4]))

text(140, 400, classes[1], cex=1.2, srt=90)

text(140, 335, classes[2], cex=1.2, srt=90)

# add in the cmtrx results

text(195, 400, res[1], cex=1.6, font=2, col=&#39;white&#39;)

text(195, 335, res[2], cex=1.6, font=2, col=&#39;white&#39;)

text(295, 400, res[3], cex=1.6, font=2, col=&#39;white&#39;)

text(295, 335, res[4], cex=1.6, font=2, col=&#39;white&#39;)

# add in the specifics

plot(c(100, 0), c(100, 0), type = &quot;n&quot;, xlab=&quot;&quot;, ylab=&quot;&quot;, main = &quot;DETAILS&quot;, xaxt=&#39;n&#39;, yaxt=&#39;n&#39;)

text(10, 85, names(cmtrx$byClass[1]), cex=1.2, font=2)

text(10, 70, round(as.numeric(cmtrx$byClass[1]), 3), cex=1.2)

text(30, 85, names(cmtrx$byClass[2]), cex=1.2, font=2)

text(30, 70, round(as.numeric(cmtrx$byClass[2]), 3), cex=1.2)

text(50, 85, names(cmtrx$byClass[5]), cex=1.2, font=2)

text(50, 70, round(as.numeric(cmtrx$byClass[5]), 3), cex=1.2)

text(70, 85, names(cmtrx$byClass[6]), cex=1.2, font=2)

text(70, 70, round(as.numeric(cmtrx$byClass[6]), 3), cex=1.2)

text(90, 85, names(cmtrx$byClass[7]), cex=1.2, font=2)

text(90, 70, round(as.numeric(cmtrx$byClass[7]), 3), cex=1.2)

# add in the accuracy information

text(30, 35, names(cmtrx$overall[1]), cex=1.5, font=2)

text(30, 20, round(as.numeric(cmtrx$overall[1]), 3), cex=1.4)

text(70, 35, names(cmtrx$overall[2]), cex=1.5, font=2)

text(70, 20, round(as.numeric(cmtrx$overall[2]), 3), cex=1.4)

}



draw_confusion_matrix(CM)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>#let’s try using randem forest for attrition, but this time let’s try varying the # of trees to see what effect this has. ## The results show that the # of trees really doesn’t change things</p>
<pre class="r"><code>set.seed(1)
splitPerc = .7
iterations = 50
masterAcc = matrix(nrow = iterations, ncol = 1)
masterSpec = matrix(nrow = iterations, ncol = 1)
masterSens = matrix(nrow = iterations, ncol = 1)

  
for(j in 1:iterations)
{
trainIndices = sample(1:dim(train)[1],round(splitPerc * nrow(train)))
trainData = train[trainIndices,]
testData = train[-trainIndices,]
  #classifications = knn(scale(trainData[,c(3,4)]),scale(testData[,c(3,4)]),as.factor(trainData$Attrition), prob = TRUE, k = i)
  rfModelTest = randomForest(Attrition ~ ., data=trainData[,includeForRF], ntree=500, importance=TRUE,
                        proximity=TRUE)
  
  predictAttritionRF = predict(rfModelTest, newdata=testData)

  CM = confusionMatrix(table(predictAttritionRF, as.factor(testData$Attrition)),positive=&quot;Yes&quot;)
  masterAcc[j,1] = CM$overall[1]
  masterSens[j,1] = CM$byClass[1][[1]] # sensitivity
  masterSpec[j,1] = CM$byClass[2][[1]] # specificity
  CM
}

MeanAcc = colMeans(masterAcc)
MeanAcc</code></pre>
<pre><code>## [1] 0.8564751</code></pre>
<pre class="r"><code>MeanSens = colMeans(masterSens)
MeanSens</code></pre>
<pre><code>## [1] 0.1577432</code></pre>
<pre class="r"><code>MeanSpec = colMeans(masterSpec)
MeanSpec</code></pre>
<pre><code>## [1] 0.9913149</code></pre>
<pre class="r"><code>CM</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##                   
## predictAttritionRF  No Yes
##                No  219  36
##                Yes   0   6
##                                           
##                Accuracy : 0.8621          
##                  95% CI : (0.8142, 0.9015)
##     No Information Rate : 0.8391          
##     P-Value [Acc &gt; NIR] : 0.1777          
##                                           
##                   Kappa : 0.2186          
##                                           
##  Mcnemar&#39;s Test P-Value : 5.433e-09       
##                                           
##             Sensitivity : 0.14286         
##             Specificity : 1.00000         
##          Pos Pred Value : 1.00000         
##          Neg Pred Value : 0.85882         
##              Prevalence : 0.16092         
##          Detection Rate : 0.02299         
##    Detection Prevalence : 0.02299         
##       Balanced Accuracy : 0.57143         
##                                           
##        &#39;Positive&#39; Class : Yes             
## </code></pre>
</div>
<div id="the-specificity-is-very-low-still-on-the-random-forest-and-naive-bayes-results.-can-we-improve-this-using-logistic-regression" class="section level1">
<h1>the specificity is very low still on the Random Forest and Naive Bayes results. Can we improve this using Logistic regression?</h1>
<div id="based-on-the-roc-curve-a-threshold-of-0.15-or-so-gives-very-good-sensitivity-and-specificity" class="section level2">
<h2>based on the ROC curve, a threshold of 0.15 or so gives very good sensitivity and specificity</h2>
<pre class="r"><code>suppressMessages(library(ROCR))

# use the value with the monthly income filled in! Use our calculated values - they may be useful for predicting attrition
trainAndMonthly = rbind(train, predictMonthlyIncomeFilledIn)

includeForLogReg = c(2,3,4,5,6,7,8,9,12,13,14,15,16,17,18,19,20,21,22,24,25,26,27,28,29.30,31,32,33,34,35,36)

logRegModel &lt;- glm(Attrition ~ ., data=trainAndMonthly[includeForLogReg], family = &quot;binomial&quot;) %&gt;%
  stepAIC(trace = FALSE)
summary(logRegModel)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Attrition ~ Age + BusinessTravel + DailyRate + 
##     DistanceFromHome + EnvironmentSatisfaction + Gender + HourlyRate + 
##     JobInvolvement + JobRole + JobSatisfaction + NumCompaniesWorked + 
##     OverTime + RelationshipSatisfaction + StockOptionLevel + 
##     TrainingTimesLastYear + WorkLifeBalance + YearsAtCompany + 
##     YearsInCurrentRole + YearsSinceLastPromotion + YearsWithCurrManager, 
##     family = &quot;binomial&quot;, data = trainAndMonthly[includeForLogReg])
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0204  -0.4603  -0.2361  -0.0789   3.5993  
## 
## Coefficients:
##                                   Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                      2.1902322  1.0551366   2.076 0.037914 *  
## Age                             -0.0503305  0.0136027  -3.700 0.000216 ***
## BusinessTravelTravel_Frequently  1.7102206  0.4518799   3.785 0.000154 ***
## BusinessTravelTravel_Rarely      0.7855449  0.4144892   1.895 0.058064 .  
## DailyRate                       -0.0004776  0.0002538  -1.882 0.059825 .  
## DistanceFromHome                 0.0514651  0.0125252   4.109 3.97e-05 ***
## EnvironmentSatisfaction2        -1.2836189  0.3250667  -3.949 7.85e-05 ***
## EnvironmentSatisfaction3        -1.0993517  0.2874468  -3.825 0.000131 ***
## EnvironmentSatisfaction4        -1.2663205  0.2863953  -4.422 9.80e-06 ***
## GenderMale                       0.4107057  0.2101575   1.954 0.050669 .  
## HourlyRate                       0.0080851  0.0050779   1.592 0.111336    
## JobInvolvement2                 -1.3521622  0.4086767  -3.309 0.000938 ***
## JobInvolvement3                 -1.6805300  0.3844921  -4.371 1.24e-05 ***
## JobInvolvement4                 -2.3565936  0.5393922  -4.369 1.25e-05 ***
## JobRoleHuman Resources           1.4051608  0.6426577   2.186 0.028780 *  
## JobRoleLaboratory Technician     1.4558831  0.5062432   2.876 0.004029 ** 
## JobRoleManager                   0.2050522  0.7090179   0.289 0.772424    
## JobRoleManufacturing Director    0.3681330  0.6177437   0.596 0.551221    
## JobRoleResearch Director        -1.7350275  1.0297330  -1.685 0.092002 .  
## JobRoleResearch Scientist        0.6385064  0.5030905   1.269 0.204381    
## JobRoleSales Executive           0.9987956  0.4940999   2.021 0.043234 *  
## JobRoleSales Representative      2.5429493  0.5679789   4.477 7.56e-06 ***
## JobSatisfaction2                -0.4983214  0.3109363  -1.603 0.109012    
## JobSatisfaction3                -0.4834701  0.2754616  -1.755 0.079238 .  
## JobSatisfaction4                -1.2480446  0.2978066  -4.191 2.78e-05 ***
## NumCompaniesWorked               0.1915761  0.0417684   4.587 4.50e-06 ***
## OverTimeYes                      2.1405217  0.2247395   9.524  &lt; 2e-16 ***
## RelationshipSatisfaction2       -0.9113317  0.3218965  -2.831 0.004638 ** 
## RelationshipSatisfaction3       -0.9701898  0.2944381  -3.295 0.000984 ***
## RelationshipSatisfaction4       -0.9469180  0.2868074  -3.302 0.000961 ***
## StockOptionLevel1               -1.2487758  0.2300506  -5.428 5.69e-08 ***
## StockOptionLevel2               -1.9674147  0.4745826  -4.146 3.39e-05 ***
## StockOptionLevel3               -0.5604686  0.4160425  -1.347 0.177934    
## TrainingTimesLastYear           -0.1573023  0.0848567  -1.854 0.063776 .  
## WorkLifeBalance2                -0.9962560  0.4124808  -2.415 0.015723 *  
## WorkLifeBalance3                -1.3570905  0.3859535  -3.516 0.000438 ***
## WorkLifeBalance4                -1.1072712  0.4798379  -2.308 0.021022 *  
## YearsAtCompany                   0.0812365  0.0379904   2.138 0.032489 *  
## YearsInCurrentRole              -0.1420790  0.0516462  -2.751 0.005941 ** 
## YearsSinceLastPromotion          0.1451945  0.0492241   2.950 0.003181 ** 
## YearsWithCurrManager            -0.1757007  0.0529565  -3.318 0.000907 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1041.34  on 1169  degrees of freedom
## Residual deviance:  660.19  on 1129  degrees of freedom
## AIC: 742.19
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<pre class="r"><code>predictAttrLogisticRegresionProbs = predict(logRegModel, trainAndMonthly, inverval=&quot;predict&quot;, type = &quot;response&quot;)

predictAttrLogisticRegresion &lt;- ifelse(predictAttrLogisticRegresionProbs &gt; 0.2, &quot;Yes&quot;, &quot;No&quot;)


predictAttrLogisticRegresion &lt;- as.factor(predictAttrLogisticRegresion)
length(predictAttrLogisticRegresion)</code></pre>
<pre><code>## [1] 1170</code></pre>
<pre class="r"><code>CM = confusionMatrix(table(predictAttrLogisticRegresion,trainAndMonthly$Attrition), positive=&quot;Yes&quot;)
CM</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##                             
## predictAttrLogisticRegresion  No Yes
##                          No  822  43
##                          Yes 157 148
##                                           
##                Accuracy : 0.8291          
##                  95% CI : (0.8062, 0.8502)
##     No Information Rate : 0.8368          
##     P-Value [Acc &gt; NIR] : 0.775           
##                                           
##                   Kappa : 0.4955          
##                                           
##  Mcnemar&#39;s Test P-Value : 1.346e-15       
##                                           
##             Sensitivity : 0.7749          
##             Specificity : 0.8396          
##          Pos Pred Value : 0.4852          
##          Neg Pred Value : 0.9503          
##              Prevalence : 0.1632          
##          Detection Rate : 0.1265          
##    Detection Prevalence : 0.2607          
##       Balanced Accuracy : 0.8073          
##                                           
##        &#39;Positive&#39; Class : Yes             
## </code></pre>
<pre class="r"><code># let&#39;s lot the ROC curve

ROCRPred &lt;- prediction(predictAttrLogisticRegresionProbs, trainAndMonthly$Attrition)
ROCRPerf &lt;- performance(ROCRPred,&quot;tpr&quot;,&quot;fpr&quot;)
plot(ROCRPerf,colorize = TRUE, print.cutoffs.at = seq(0.1, by = 0.1))</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
</div>
<div id="show-aic-linear-regression-confision-matrix" class="section level1">
<h1>Show AIC Linear regression Confision Matrix</h1>
<pre class="r"><code># write out the naive bayes results



draw_confusion_matrix &lt;- function(cmtrx) {

total &lt;- sum(cmtrx$table)

res &lt;- as.numeric(cmtrx$table)

# Generate color gradients. Palettes come from RColorBrewer.

greenPalette &lt;- c(&quot;#F7FCF5&quot;,&quot;#E5F5E0&quot;,&quot;#C7E9C0&quot;,&quot;#A1D99B&quot;,&quot;#74C476&quot;,&quot;#41AB5D&quot;,&quot;#238B45&quot;,&quot;#006D2C&quot;,&quot;#00441B&quot;)

redPalette &lt;- c(&quot;#FFF5F0&quot;,&quot;#FEE0D2&quot;,&quot;#FCBBA1&quot;,&quot;#FC9272&quot;,&quot;#FB6A4A&quot;,&quot;#EF3B2C&quot;,&quot;#CB181D&quot;,&quot;#A50F15&quot;,&quot;#67000D&quot;)

getColor &lt;- function (greenOrRed = &quot;green&quot;, amount = 0) {

if (amount == 0)

return(&quot;#FFFFFF&quot;)

palette &lt;- greenPalette

if (greenOrRed == &quot;red&quot;)

palette &lt;- redPalette

colorRampPalette(palette)(100)[10 + ceiling(90 * amount / total)]

}

# set the basic layout

layout(matrix(c(1,1,2)))

par(mar=c(2,2,2,2))

plot(c(100, 345), c(300, 450), type = &quot;n&quot;, xlab=&quot;&quot;, ylab=&quot;&quot;, xaxt=&#39;n&#39;, yaxt=&#39;n&#39;)

title(&#39;CONFUSION MATRIX - Training Data&#39;, cex.main=2)

# create the matrix

classes = colnames(cmtrx$table)

rect(150, 430, 240, 370, col=getColor(&quot;green&quot;, res[1]))

text(195, 435, classes[1], cex=1.2)

rect(250, 430, 340, 370, col=getColor(&quot;red&quot;, res[3]))

text(295, 435, classes[2], cex=1.2)

text(125, 370, &#39;Predicted&#39;, cex=1.3, srt=90, font=2)

text(245, 450, &#39;Actual&#39;, cex=1.3, font=2)

rect(150, 305, 240, 365, col=getColor(&quot;red&quot;, res[2]))

rect(250, 305, 340, 365, col=getColor(&quot;green&quot;, res[4]))

text(140, 400, classes[1], cex=1.2, srt=90)

text(140, 335, classes[2], cex=1.2, srt=90)

# add in the cmtrx results

text(195, 400, res[1], cex=1.6, font=2, col=&#39;white&#39;)

text(195, 335, res[2], cex=1.6, font=2, col=&#39;white&#39;)

text(295, 400, res[3], cex=1.6, font=2, col=&#39;white&#39;)

text(295, 335, res[4], cex=1.6, font=2, col=&#39;white&#39;)

# add in the specifics

plot(c(100, 0), c(100, 0), type = &quot;n&quot;, xlab=&quot;&quot;, ylab=&quot;&quot;, main = &quot;DETAILS&quot;, xaxt=&#39;n&#39;, yaxt=&#39;n&#39;)

text(10, 85, names(cmtrx$byClass[1]), cex=1.2, font=2)

text(10, 70, round(as.numeric(cmtrx$byClass[1]), 3), cex=1.2)

text(30, 85, names(cmtrx$byClass[2]), cex=1.2, font=2)

text(30, 70, round(as.numeric(cmtrx$byClass[2]), 3), cex=1.2)

text(50, 85, names(cmtrx$byClass[5]), cex=1.2, font=2)

text(50, 70, round(as.numeric(cmtrx$byClass[5]), 3), cex=1.2)

text(70, 85, names(cmtrx$byClass[6]), cex=1.2, font=2)

text(70, 70, round(as.numeric(cmtrx$byClass[6]), 3), cex=1.2)

text(90, 85, names(cmtrx$byClass[7]), cex=1.2, font=2)

text(90, 70, round(as.numeric(cmtrx$byClass[7]), 3), cex=1.2)

# add in the accuracy information

text(30, 35, names(cmtrx$overall[1]), cex=1.5, font=2)

text(30, 20, round(as.numeric(cmtrx$overall[1]), 3), cex=1.4)

text(70, 35, names(cmtrx$overall[2]), cex=1.5, font=2)

text(70, 20, round(as.numeric(cmtrx$overall[2]), 3), cex=1.4)

}



draw_confusion_matrix(CM)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
</div>
<div id="lets-try-that-last-model-against-our-validation-data-with-prob-0.20" class="section level1">
<h1>let’s try that last model against our validation data, with prob &gt; 0.20</h1>
<pre class="r"><code>predictAttrLogisticRegresion &lt;- ifelse(predictAttrLogisticRegresionProbs &gt; 0.15, &quot;Yes&quot;, &quot;No&quot;)

head(train$Attrition)</code></pre>
<pre><code>## [1] No No No No No No
## Levels: No Yes</code></pre>
<pre class="r"><code>predictAttrLogisticRegresion &lt;- as.factor(predictAttrLogisticRegresion)
length(predictAttrLogisticRegresion)</code></pre>
<pre><code>## [1] 1170</code></pre>
<pre class="r"><code>str(predictAttrLogisticRegresion)</code></pre>
<pre><code>##  Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 2 1 2 1 2 1 ...
##  - attr(*, &quot;names&quot;)= chr [1:1170] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...</code></pre>
<pre class="r"><code>str(train$Attrition)</code></pre>
<pre><code>##  Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>head(predictAttrLogisticRegresion)</code></pre>
<pre><code>##   1   2   3   4   5   6 
##  No  No  No  No Yes  No 
## Levels: No Yes</code></pre>
<pre class="r"><code>CM = confusionMatrix(table(predictAttrLogisticRegresion,trainAndMonthly$Attrition),positive=&quot;Yes&quot;)
CM</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##                             
## predictAttrLogisticRegresion  No Yes
##                          No  764  34
##                          Yes 215 157
##                                           
##                Accuracy : 0.7872          
##                  95% CI : (0.7626, 0.8103)
##     No Information Rate : 0.8368          
##     P-Value [Acc &gt; NIR] : 1               
##                                           
##                   Kappa : 0.4361          
##                                           
##  Mcnemar&#39;s Test P-Value : &lt;2e-16          
##                                           
##             Sensitivity : 0.8220          
##             Specificity : 0.7804          
##          Pos Pred Value : 0.4220          
##          Neg Pred Value : 0.9574          
##              Prevalence : 0.1632          
##          Detection Rate : 0.1342          
##    Detection Prevalence : 0.3179          
##       Balanced Accuracy : 0.8012          
##                                           
##        &#39;Positive&#39; Class : Yes             
## </code></pre>
</div>
<div id="try-the-glm-model-with-traintest-split-to-gauge-the-confusion-matrix-results" class="section level1">
<h1>try the GLM model with train/test split to gauge the confusion matrix results</h1>
</div>
<div id="this-is-terribly-slow-and-it-gets-a-different-model-each-time-so-very-difficult-to-gauge-effectiveness-this-way" class="section level1">
<h1>this is terribly slow and it gets a different model each time… so very difficult to gauge effectiveness this way</h1>
<div id="this-is-way-too-slow-and-the-model-is-different-every-time-so-whats-the-point" class="section level2">
<h2>This is way too slow, and the model is different every time, so what’s the point?</h2>
</div>
<div id="we-want-to-train-and-test-with-a-consistent-model-across-all-our-cross-validation-steps" class="section level2">
<h2>We want to train and test with a consistent model across all our cross-validation steps</h2>
<pre class="r"><code>set.seed(1)
splitPerc = .7
iterations = 2
masterAcc = matrix(nrow = iterations, 1)
masterSpec = matrix(nrow = iterations, 1)
masterSens = matrix(nrow = iterations, 1)

for(j in 1:iterations)
{
trainIndices = sample(1:dim(trainAndMonthly)[1],round(splitPerc * nrow(trainAndMonthly)))
trainData = trainAndMonthly[trainIndices,]
testData = trainAndMonthly[-trainIndices,]


logRegModel &lt;- glm(Attrition ~ ., data=trainAndMonthly[includeForLogReg], family = &quot;binomial&quot;) %&gt;%
  stepAIC(trace = FALSE)

  predictAttrLogisticRegresionProbs = predict(logRegModel, trainAndMonthly, inverval=&quot;predict&quot;, type = &quot;response&quot;)
  
  predictAttrLogisticRegresion &lt;- ifelse(predictAttrLogisticRegresionProbs &gt; 0.2, &quot;Yes&quot;, &quot;No&quot;)
  
  
  predictAttrLogisticRegresion &lt;- as.factor(predictAttrLogisticRegresion)
  length(predictAttrLogisticRegresion)
  
  
  CM = confusionMatrix(table(predictAttrLogisticRegresion,trainAndMonthly$Attrition),positive=&quot;Yes&quot;)
  CM
  
  
  
  masterAcc[j,1] = CM$overall[1]
  masterSens[j,1] = CM$byClass[1][[1]] # sensitivity
  masterSpec[j,1] = CM$byClass[2][[1]] # specificity
}

masterAcc</code></pre>
<pre><code>##           [,1]
## [1,] 0.8290598
## [2,] 0.8290598</code></pre>
<pre class="r"><code>MeanAcc = colMeans(masterAcc)
MeanAcc</code></pre>
<pre><code>## [1] 0.8290598</code></pre>
</div>
</div>
<div id="using-a-manual-model-with-the-most-promising-fields" class="section level1">
<h1>using a manual model with the most promising fields</h1>
<div id="create-the-model-with-the-training-data" class="section level2">
<h2>create the model with the training data</h2>
<pre class="r"><code>suppressMessages(library(ROCR))

# use the value with the monthly income filled in! Use our calculated values - they may be useful for predicting attrition
trainAndMonthly = rbind(train, predictMonthlyIncomeFilledIn)

includeForLogReg = c(2,3,4,5,6,7,8,9,12,13,14,15,16,17,18,19,20,21,22,24,25,26,27,28,29.30,31,32,33,34,35,36)

logRegModel &lt;- glm(Attrition ~ Age + BusinessTravel + DailyRate +  DistanceFromHome +  EnvironmentSatisfaction + HourlyRate + JobLevel  + JobRole + JobSatisfaction  + NumCompaniesWorked + OverTime + StockOptionLevel + WorkLifeBalance + YearsAtCompany  + YearsSinceLastPromotion, data=trainAndMonthly[includeForLogReg], family = &quot;binomial&quot;) 
summary(logRegModel)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Attrition ~ Age + BusinessTravel + DailyRate + 
##     DistanceFromHome + EnvironmentSatisfaction + HourlyRate + 
##     JobLevel + JobRole + JobSatisfaction + NumCompaniesWorked + 
##     OverTime + StockOptionLevel + WorkLifeBalance + YearsAtCompany + 
##     YearsSinceLastPromotion, family = &quot;binomial&quot;, data = trainAndMonthly[includeForLogReg])
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.9741  -0.4887  -0.2711  -0.1123   3.9241  
## 
## Coefficients:
##                                   Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                      1.2552671  0.9486894   1.323 0.185782    
## Age                             -0.0441123  0.0130892  -3.370 0.000751 ***
## BusinessTravelTravel_Frequently  1.5161498  0.4310237   3.518 0.000436 ***
## BusinessTravelTravel_Rarely      0.7032475  0.3978659   1.768 0.077136 .  
## DailyRate                       -0.0005161  0.0002456  -2.102 0.035587 *  
## DistanceFromHome                 0.0440787  0.0118485   3.720 0.000199 ***
## EnvironmentSatisfaction2        -1.1946833  0.3109987  -3.841 0.000122 ***
## EnvironmentSatisfaction3        -1.1231583  0.2744110  -4.093 4.26e-05 ***
## EnvironmentSatisfaction4        -1.2057602  0.2729599  -4.417 9.99e-06 ***
## HourlyRate                       0.0071089  0.0048619   1.462 0.143695    
## JobLevel2                       -1.3520656  0.3971628  -3.404 0.000663 ***
## JobLevel3                       -1.6854379  0.3750157  -4.494 6.98e-06 ***
## JobLevel4                       -2.2746771  0.5221527  -4.356 1.32e-05 ***
## JobRoleHuman Resources           1.2625238  0.6136876   2.057 0.039660 *  
## JobRoleLaboratory Technician     1.2358337  0.4812186   2.568 0.010225 *  
## JobRoleManager                   0.2396844  0.6894364   0.348 0.728101    
## JobRoleManufacturing Director    0.0929140  0.5873320   0.158 0.874302    
## JobRoleResearch Director        -1.4759585  0.9287324  -1.589 0.112011    
## JobRoleResearch Scientist        0.5947935  0.4796452   1.240 0.214950    
## JobRoleSales Executive           0.8427604  0.4707331   1.790 0.073403 .  
## JobRoleSales Representative      2.4020655  0.5393920   4.453 8.46e-06 ***
## JobSatisfaction2                -0.3854666  0.2983800  -1.292 0.196404    
## JobSatisfaction3                -0.4208734  0.2624351  -1.604 0.108775    
## JobSatisfaction4                -1.1503510  0.2842737  -4.047 5.20e-05 ***
## NumCompaniesWorked               0.1690484  0.0398307   4.244 2.19e-05 ***
## OverTimeYes                      1.9865547  0.2114434   9.395  &lt; 2e-16 ***
## StockOptionLevel1               -1.1332201  0.2197640  -5.157 2.52e-07 ***
## StockOptionLevel2               -1.8406855  0.4562480  -4.034 5.47e-05 ***
## StockOptionLevel3               -0.4460563  0.4017835  -1.110 0.266917    
## WorkLifeBalance2                -1.0772779  0.3928362  -2.742 0.006101 ** 
## WorkLifeBalance3                -1.3618824  0.3648384  -3.733 0.000189 ***
## WorkLifeBalance4                -1.2042954  0.4599882  -2.618 0.008842 ** 
## YearsAtCompany                  -0.0523385  0.0271194  -1.930 0.053616 .  
## YearsSinceLastPromotion          0.1060962  0.0448531   2.365 0.018010 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1041.3  on 1169  degrees of freedom
## Residual deviance:  703.5  on 1136  degrees of freedom
## AIC: 771.5
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="r"><code>predictAttrLogisticRegresionProbs = predict(logRegModel, trainAndMonthly, inverval=&quot;predict&quot;, type = &quot;response&quot;)

predictAttrLogisticRegresion &lt;- ifelse(predictAttrLogisticRegresionProbs &gt; 0.15, &quot;Yes&quot;, &quot;No&quot;)


predictAttrLogisticRegresion &lt;- as.factor(predictAttrLogisticRegresion)
length(predictAttrLogisticRegresion)</code></pre>
<pre><code>## [1] 1170</code></pre>
<pre class="r"><code>CM = confusionMatrix(table(predictAttrLogisticRegresion,trainAndMonthly$Attrition),positive=&quot;Yes&quot;)
CM</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##                             
## predictAttrLogisticRegresion  No Yes
##                          No  743  39
##                          Yes 236 152
##                                          
##                Accuracy : 0.765          
##                  95% CI : (0.7396, 0.789)
##     No Information Rate : 0.8368         
##     P-Value [Acc &gt; NIR] : 1              
##                                          
##                   Kappa : 0.392          
##                                          
##  Mcnemar&#39;s Test P-Value : &lt;2e-16         
##                                          
##             Sensitivity : 0.7958         
##             Specificity : 0.7589         
##          Pos Pred Value : 0.3918         
##          Neg Pred Value : 0.9501         
##              Prevalence : 0.1632         
##          Detection Rate : 0.1299         
##    Detection Prevalence : 0.3316         
##       Balanced Accuracy : 0.7774         
##                                          
##        &#39;Positive&#39; Class : Yes            
## </code></pre>
<pre class="r"><code># let&#39;s lot the ROC curve

ROCRPred &lt;- prediction(predictAttrLogisticRegresionProbs, trainAndMonthly$Attrition)
ROCRPerf &lt;- performance(ROCRPred,&quot;tpr&quot;,&quot;fpr&quot;)
plot(ROCRPerf,colorize = TRUE, print.cutoffs.at = seq(0.1, by = 0.1))</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
</div>
<div id="using-a-very-low-threshold-here-to-make-sure-the-specificity-is-higher-than-our-0.6-goal-even-if-it-results-in-lower-accuracy." class="section level1">
<h1>using a very low threshold here to make sure the specificity is higher than our 0.6 goal, even if it results in lower accuracy.</h1>
<pre class="r"><code>predictAttritionResultsValidationProbs = predict(logRegModel, predictAttr, inverval=&quot;predict&quot;, type = &quot;response&quot;)

predictAttritionResultsValidation &lt;- ifelse(predictAttritionResultsValidationProbs &gt; 0.12, &quot;Yes&quot;, &quot;No&quot;)

# create a separate dataset with attrition filled in to avoid future confusion
predictAttrFilledIn = predictAttr
# use the predicted values


predictAttrFilledIn$Attrition = predictAttritionResultsValidation
predictAttrWithID = predictAttrFilledIn[, c(&quot;ID&quot;, &quot;Attrition&quot;)]
write.csv(predictAttrWithID, file=&quot;Case2PredictionsPaugh Attrition.csv&quot;, row.names=FALSE)
predictAttrWithEmployeeNumber = predictAttrFilledIn[, c(&quot;EmployeeNumber&quot;, &quot;Attrition&quot;)]
write.csv(predictAttrWithEmployeeNumber, file=&quot;Case2PredictionsByENAttrition.csv&quot;, row.names=FALSE)</code></pre>
</div>
<div id="using-a-manual-model-with-the-most-promosing-fields" class="section level1">
<h1>using a manual model with the most promosing fields</h1>
<div id="this-creates-essentially-a-manual-roc-curve-of-the-cross-validation-data-by-calculating-the-specificity-and-sensitivity-at-each-point" class="section level2">
<h2>This creates essentially a manual ROC curve of the cross validation data, by calculating the specificity and sensitivity at each point</h2>
<pre class="r"><code>set.seed(1)
splitPerc = .7
iterations = 50
thresholdValues = seq(0,1,0.01)
thresholdIterations = length(thresholdValues)
masterAcc = matrix(nrow = iterations, ncol=thresholdIterations)
masterSpec = matrix(nrow = iterations, ncol=thresholdIterations)
masterSens = matrix(nrow = iterations, ncol=thresholdIterations)
masterCombined = matrix(nrow = iterations, ncol=thresholdIterations)


for(j in 1:iterations)
{
  
  trainIndices = sample(1:dim(trainAndMonthly)[1],round(splitPerc * nrow(trainAndMonthly)))
  trainData = trainAndMonthly[trainIndices,]
  testData = trainAndMonthly[-trainIndices,]
  
  logRegModel &lt;- glm(Attrition ~ Age + BusinessTravel + DailyRate +  DistanceFromHome +  Education + EnvironmentSatisfaction + HourlyRate + JobLevel  + JobRole  + JobSatisfaction  +  NumCompaniesWorked + OverTime + StockOptionLevel + WorkLifeBalance + YearsAtCompany  + YearsSinceLastPromotion, data=trainData, family = &quot;binomial&quot;)

  predictAttrLogisticRegresionProbs = predict(logRegModel, testData, inverval=&quot;predict&quot;, type = &quot;response&quot;)
  
  for (i in 1:length(thresholdValues))
  {
  
    predictAttrLogisticRegresion &lt;- ifelse(predictAttrLogisticRegresionProbs &gt; thresholdValues[i], &quot;Yes&quot;, &quot;No&quot;)
  
    predictAttrLogisticRegresion &lt;- as.factor(predictAttrLogisticRegresion)
  
    levels(predictAttrLogisticRegresion) = levels(testData$Attrition)
    CM = confusionMatrix(table(predictAttrLogisticRegresion, as.factor(testData$Attrition)),positive=&quot;Yes&quot;)
    masterAcc[j,i] = CM$overall[1]
    masterSens[j,i] = CM$byClass[1][[1]] # sensitivity
    masterSpec[j,i] = CM$byClass[2][[1]] # specificity
    masterCombined[j,i] =  CM$byClass[1][[1]] + CM$byClass[2][[1]] # combined
  }
}
# all the rows in the same column have the same threshold value, so average across the column to get the average for threshold
MeanAcc = colMeans(masterAcc)

plot(seq(1,thresholdIterations,1),MeanAcc, type = &quot;l&quot;, main=&quot;Accuracy by Threshold&quot;,xlab = &quot;Threshold&quot;, ylab=&quot;Accuracy&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<pre class="r"><code>which.max(MeanAcc)</code></pre>
<pre><code>## [1] 58</code></pre>
<pre class="r"><code>max(MeanAcc)</code></pre>
<pre><code>## [1] 0.8727066</code></pre>
<pre class="r"><code>MeanSens = colMeans(masterSens)

plot(seq(1,thresholdIterations,1),MeanSens, type = &quot;l&quot;, main=&quot;Sensitivity by Threshold&quot;, xlab = &quot;Threshold&quot;, ylab=&quot;Sensitivity&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-33-2.png" width="672" /></p>
<pre class="r"><code>which.max(MeanSens)</code></pre>
<pre><code>## [1] 2</code></pre>
<pre class="r"><code>thresholdValues[which.max(MeanSens)]</code></pre>
<pre><code>## [1] 0.01</code></pre>
<pre class="r"><code>max(MeanSens)</code></pre>
<pre><code>## [1] 0.9624236</code></pre>
<pre class="r"><code>MeanSpec = colMeans(masterSpec)

plot(seq(1,thresholdIterations,1),MeanSpec, type = &quot;l&quot;, main=&quot;Specificity by Threshold&quot;,xlab = &quot;Threshold&quot;, ylab=&quot;Specificity&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-33-3.png" width="672" /></p>
<pre class="r"><code>which.max(MeanSpec)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code>thresholdValues[which.max(MeanSpec)]</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>max(MeanSpec)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code>MeanCombined = colMeans(masterCombined)
plot(seq(1,thresholdIterations,1),MeanCombined, type = &quot;l&quot;, main=&quot;Sensitivity + Specificity by Threshold&quot;, xlab = &quot;Threshold&quot;, ylab=&quot;Sensitivity + Specificity&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-33-4.png" width="672" /></p>
<pre class="r"><code>which.max(MeanCombined)</code></pre>
<pre><code>## [1] 22</code></pre>
<pre class="r"><code>thresholdValues[which.max(MeanCombined)]</code></pre>
<pre><code>## [1] 0.21</code></pre>
<pre class="r"><code>max(MeanCombined)</code></pre>
<pre><code>## [1] 1.513913</code></pre>
<pre class="r"><code>dfTestingResults = data.frame(MeanCombined)
names(dfTestingResults)[1]&lt;-&quot;Sum&quot;
dfTestingResults$Threshold =thresholdValues
dfTestingResults$Specificity = MeanSpec
dfTestingResults$Sensitivity = MeanSens
#dfTestingResults


# this works but it does not show a group name
p = ggplot() + 
  geom_line(data = dfTestingResults, aes(x = Threshold, y = MeanSpec), color = &quot;blue&quot;) +
  geom_line(data = dfTestingResults, aes(x = Threshold, y = MeanSens), color = &quot;red&quot;) +
  geom_line(data = dfTestingResults, aes(x = Threshold, y = Sum), color = &quot;green&quot;) +
  xlab(&#39;Dates&#39;) +
  ylab(&#39;percent.change&#39;) + theme_economist()
p</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-33-5.png" width="672" /></p>
<pre class="r"><code>dfMeltThresholdData &lt;- melt(dfTestingResults, id.vars=&quot;Threshold&quot;, value.name=&quot;value&quot;)
ggplot(dfMeltThresholdData, aes(x=Threshold, y=value, color=variable)) + ylab(&quot;Value&quot;) + ggtitle(&quot;Test Results by Threshold&quot;) +
  geom_point()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-33-6.png" width="672" /></p>
</div>
</div>
<div id="lets-try-logistic-regression-but-with-a-manually-created-model" class="section level1">
<h1>lets try logistic regression but with a manually created model</h1>
<div id="this-uses-the-new-variables-that-focus-on-the-factors-that-led-to-attrtion-in-our-training-data" class="section level2">
<h2>this uses the new variables that focus on the factors that led to attrtion in our training data</h2>
<pre class="r"><code>#str(trainAndMonthly)
trainAndMonthly = rbind(train, predictMonthlyIncomeFilledIn)

includeForLogReg = c(2,3,4,5,6,7,8,9,12, 13,14,15,16,17,18,19,21,22,24,25,26,27,28,29.30,31,32,33,34,35,36)

#logRegModel &lt;- glm(Attrition ~ BusinessTravelFrequently + LowEducation + LowEnvironmentalSatisfaction + LowJobLevel + JobRoleSales + HighCompaniesWorked + LowWorkLifeBalance + JobRoleMed + Age + YearsInCurrentRole + DistanceFromHome + OverTime + DailyRate, data=trainAndMonthly, family = &quot;binomial&quot;) %&gt;%
#  stepAIC(trace = FALSE)

logRegModel &lt;- glm(Attrition ~ BusinessTravelFrequently + LowEducation + LowEnvironmentalSatisfaction + LowJobLevel + JobRoleSales + HighCompaniesWorked + LowWorkLifeBalance + JobRoleMed + Age + DistanceFromHome + OverTime, data=trainAndMonthly, family = &quot;binomial&quot;) 

summary(logRegModel)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Attrition ~ BusinessTravelFrequently + LowEducation + 
##     LowEnvironmentalSatisfaction + LowJobLevel + JobRoleSales + 
##     HighCompaniesWorked + LowWorkLifeBalance + JobRoleMed + Age + 
##     DistanceFromHome + OverTime, family = &quot;binomial&quot;, data = trainAndMonthly)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.7015  -0.5492  -0.3756  -0.2110   3.0714  
## 
## Coefficients:
##                                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                     -3.54587    0.80554  -4.402 1.07e-05 ***
## BusinessTravelFrequentlyYes      0.73073    0.20739   3.523 0.000426 ***
## LowEducationYes                  0.31258    0.58445   0.535 0.592763    
## LowEnvironmentalSatisfactionYes  0.39386    0.20083   1.961 0.049860 *  
## LowJobLevelYes                   0.60182    0.21488   2.801 0.005099 ** 
## JobRoleSalesYes                  1.84317    0.40670   4.532 5.84e-06 ***
## HighCompaniesWorkedYes           1.01589    0.22425   4.530 5.90e-06 ***
## LowWorkLifeBalanceYes            1.16410    0.31436   3.703 0.000213 ***
## JobRoleMedYes                    0.75751    0.27752   2.730 0.006342 ** 
## Age                             -0.03077    0.01137  -2.706 0.006802 ** 
## DistanceFromHome                 0.03758    0.01081   3.475 0.000512 ***
## OverTimeYes                      1.62067    0.18213   8.899  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1041.3  on 1169  degrees of freedom
## Residual deviance:  832.9  on 1158  degrees of freedom
## AIC: 856.9
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>predictAttrLogisticRegresionProbs = predict(logRegModel, trainAndMonthly, inverval=&quot;predict&quot;, type = &quot;response&quot;)

predictAttrLogisticRegresion &lt;- ifelse(predictAttrLogisticRegresionProbs &gt; 0.2, &quot;Yes&quot;, &quot;No&quot;)


head(train$Attrition)</code></pre>
<pre><code>## [1] No No No No No No
## Levels: No Yes</code></pre>
<pre class="r"><code>predictAttrLogisticRegresion &lt;- as.factor(predictAttrLogisticRegresion)
length(predictAttrLogisticRegresion)</code></pre>
<pre><code>## [1] 1170</code></pre>
<pre class="r"><code>str(predictAttrLogisticRegresion)</code></pre>
<pre><code>##  Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 2 1 2 1 2 1 ...
##  - attr(*, &quot;names&quot;)= chr [1:1170] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...</code></pre>
<pre class="r"><code>str(train$Attrition)</code></pre>
<pre><code>##  Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<pre class="r"><code>head(predictAttrLogisticRegresion)</code></pre>
<pre><code>##   1   2   3   4   5   6 
##  No  No  No  No Yes  No 
## Levels: No Yes</code></pre>
<pre class="r"><code>CM = confusionMatrix(table(predictAttrLogisticRegresion,trainAndMonthly$Attrition),positive=&quot;Yes&quot;)
CM</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##                             
## predictAttrLogisticRegresion  No Yes
##                          No  770  63
##                          Yes 209 128
##                                           
##                Accuracy : 0.7675          
##                  95% CI : (0.7422, 0.7915)
##     No Information Rate : 0.8368          
##     P-Value [Acc &gt; NIR] : 1               
##                                           
##                   Kappa : 0.3492          
##                                           
##  Mcnemar&#39;s Test P-Value : &lt;2e-16          
##                                           
##             Sensitivity : 0.6702          
##             Specificity : 0.7865          
##          Pos Pred Value : 0.3798          
##          Neg Pred Value : 0.9244          
##              Prevalence : 0.1632          
##          Detection Rate : 0.1094          
##    Detection Prevalence : 0.2880          
##       Balanced Accuracy : 0.7283          
##                                           
##        &#39;Positive&#39; Class : Yes             
## </code></pre>
<pre class="r"><code># let&#39;s lot the ROC curve

ROCRPred &lt;- prediction(predictAttrLogisticRegresionProbs, trainAndMonthly$Attrition)
ROCRPerf &lt;- performance(ROCRPred,&quot;tpr&quot;,&quot;fpr&quot;)
plot(ROCRPerf,colorize = TRUE, print.cutoffs.at = seq(0.1, by = 0.1))</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
</div>
</div>
<div id="repeat-manual-model-but-not-with-many-iteration-of-traintest-testing-to-check-confusion-matrix-results" class="section level1">
<h1>repeat manual model, but not with many iteration of train/test testing to check confusion matrix results</h1>
<pre class="r"><code>set.seed(1)
splitPerc = .7
iterations = 50
thresholdValues = seq(0,1,0.01)
thresholdIterations = length(thresholdValues)
masterAcc = matrix(nrow = iterations, ncol=thresholdIterations)
masterSpec = matrix(nrow = iterations, ncol=thresholdIterations)
masterSens = matrix(nrow = iterations, ncol=thresholdIterations)
masterCombined = matrix(nrow = iterations, ncol=thresholdIterations)


for(j in 1:iterations)
{
  
  trainIndices = sample(1:dim(trainAndMonthly)[1],round(splitPerc * nrow(trainAndMonthly)))
  trainData = trainAndMonthly[trainIndices,]
  testData = trainAndMonthly[-trainIndices,]
  
  #logRegModel &lt;- glm(Attrition ~ BusinessTravelFrequently + LowEducation + LowEnvironmentalSatisfaction + LowJobLevel + JobRoleSales + HighCompaniesWorked + LowWorkLifeBalance + JobRoleMed + Age + YearsInCurrentRole + DistanceFromHome + OverTime + DailyRate, data=trainAndMonthly, family = &quot;binomial&quot;) %&gt;%
  #  stepAIC(trace = FALSE)
  
  logRegModel &lt;- glm(Attrition ~ BusinessTravelFrequently + LowEducation + LowEnvironmentalSatisfaction + LowJobLevel + JobRoleSales + HighCompaniesWorked + LowWorkLifeBalance + JobRoleMed + Age + DistanceFromHome + OverTime, data=trainData, family = &quot;binomial&quot;) 
  

  predictAttrLogisticRegresionProbs = predict(logRegModel, testData, inverval=&quot;predict&quot;, type = &quot;response&quot;)
  
  for (i in 1:length(thresholdValues))
  {
  
    predictAttrLogisticRegresion &lt;- ifelse(predictAttrLogisticRegresionProbs &gt; thresholdValues[i], &quot;Yes&quot;, &quot;No&quot;)
  
    predictAttrLogisticRegresion &lt;- as.factor(predictAttrLogisticRegresion)
  
    levels(predictAttrLogisticRegresion) = levels(testData$Attrition)
    CM = confusionMatrix(table(predictAttrLogisticRegresion, as.factor(testData$Attrition)),positive=&quot;Yes&quot;)
    masterAcc[j,i] = CM$overall[1]
    masterSens[j,i] = CM$byClass[1][[1]] # sensitivity
    masterSpec[j,i] = CM$byClass[2][[1]] # specificity
    masterCombined[j,i] =  CM$byClass[1][[1]] + CM$byClass[2][[1]] # combined
  }
}
# all the rows in the same column have the same threshold value, so average across the column to get the average for threshold
MeanAcc = colMeans(masterAcc)

plot(seq(1,thresholdIterations,1),MeanAcc, type = &quot;l&quot;, xlab = &quot;Threshold&quot;, ylab=&quot;Accuracy&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<pre class="r"><code>which.max(MeanAcc)</code></pre>
<pre><code>## [1] 56</code></pre>
<pre class="r"><code>max(MeanAcc)</code></pre>
<pre><code>## [1] 0.8500855</code></pre>
<pre class="r"><code>MeanSens = colMeans(masterSens)

plot(seq(1,thresholdIterations,1),MeanSens, type = &quot;l&quot;, xlab = &quot;Threshold&quot;, ylab=&quot;Sensitivity&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-35-2.png" width="672" /></p>
<pre class="r"><code>which.max(MeanSens)</code></pre>
<pre><code>## [1] 3</code></pre>
<pre class="r"><code>thresholdValues[which.max(MeanSens)]</code></pre>
<pre><code>## [1] 0.02</code></pre>
<pre class="r"><code>max(MeanSens)</code></pre>
<pre><code>## [1] 0.9727179</code></pre>
<pre class="r"><code>MeanSpec = colMeans(masterSpec)

plot(seq(1,thresholdIterations,1),MeanSpec, type = &quot;l&quot;, xlab = &quot;Threshold&quot;, ylab=&quot;Specificity&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-35-3.png" width="672" /></p>
<pre class="r"><code>which.max(MeanSpec)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code>thresholdValues[which.max(MeanSpec)]</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>max(MeanSpec)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code>MeanCombined = colMeans(masterCombined)
plot(seq(1,thresholdIterations,1),MeanCombined, type = &quot;l&quot;, xlab = &quot;Threshold&quot;, ylab=&quot;Sensitivity + Specificity&quot;)</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-35-4.png" width="672" /></p>
<pre class="r"><code>which.max(MeanCombined)</code></pre>
<pre><code>## [1] 20</code></pre>
<pre class="r"><code>thresholdValues[which.max(MeanCombined)]</code></pre>
<pre><code>## [1] 0.19</code></pre>
<pre class="r"><code>max(MeanCombined)</code></pre>
<pre><code>## [1] 1.439611</code></pre>
<pre class="r"><code>dfTestingResults &lt;- data.frame(MeanCombined)
dfTestingResults &lt;- dfTestingResults %&gt;% rename(    Sum = MeanCombined    )
dfTestingResults$Threshold =thresholdValues
dfTestingResults$Specificity = MeanSpec
dfTestingResults$Sensitivity = MeanSens
dfTestingResults</code></pre>
<pre><code>##          Sum Threshold Specificity  Sensitivity
## 1   1.000000      0.00  1.00000000 0.0000000000
## 2   1.011088      0.01  0.15907729 0.8520111802
## 3   1.068507      0.02  0.09578871 0.9727178944
## 4   1.118129      0.03  0.17192699 0.9462019650
## 5   1.162486      0.04  0.24435949 0.9181263242
## 6   1.212290      0.05  0.30835999 0.9039304456
## 7   1.260490      0.06  0.36909701 0.8913933031
## 8   1.301919      0.07  0.42408913 0.8778296026
## 9   1.341031      0.08  0.48003504 0.8609959012
## 10  1.364659      0.09  0.52409935 0.8405596611
## 11  1.386943      0.10  0.56633907 0.8206040243
## 12  1.402382      0.11  0.60426624 0.7981160844
## 13  1.412552      0.12  0.63835865 0.7741935757
## 14  1.419301      0.13  0.66625676 0.7530440878
## 15  1.425738      0.14  0.69165592 0.7340823020
## 16  1.433053      0.15  0.71366805 0.7193852186
## 17  1.432908      0.16  0.73173313 0.7011751111
## 18  1.436831      0.17  0.74907238 0.6877587381
## 19  1.436696      0.18  0.76444701 0.6722493551
## 20  1.439611      0.19  0.77892351 0.6606878852
## 21  1.438783      0.20  0.79160895 0.6471737689
## 22  1.437386      0.21  0.80535638 0.6320295105
## 23  1.437974      0.22  0.81870998 0.6192644754
## 24  1.438570      0.23  0.83240527 0.6061650846
## 25  1.439469      0.24  0.84442365 0.5950456894
## 26  1.434876      0.25  0.85487751 0.5799983308
## 27  1.435026      0.26  0.86634189 0.5686840954
## 28  1.429539      0.27  0.87555492 0.5539837309
## 29  1.420649      0.28  0.88490659 0.5357422293
## 30  1.408017      0.29  0.89140739 0.5166093947
## 31  1.395974      0.30  0.89802805 0.4979456847
## 32  1.384397      0.31  0.90488579 0.4795115263
## 33  1.374433      0.32  0.91049945 0.4639339906
## 34  1.363815      0.33  0.91650544 0.4473091662
## 35  1.353979      0.34  0.92150989 0.4324690076
## 36  1.343844      0.35  0.92609376 0.4177506848
## 37  1.333483      0.36  0.93054734 0.4029352606
## 38  1.324344      0.37  0.93479496 0.3895486641
## 39  1.315233      0.38  0.93853278 0.3767005617
## 40  1.307343      0.39  0.94248667 0.3648566854
## 41  1.297094      0.40  0.94494650 0.3521475901
## 42  1.290282      0.41  0.94892920 0.3413530833
## 43  1.281386      0.42  0.95165699 0.3297289435
## 44  1.273825      0.43  0.95500679 0.3188183219
## 45  1.261632      0.44  0.95815675 0.3034752161
## 46  1.258266      0.45  0.96109513 0.2971703685
## 47  1.252478      0.46  0.96314830 0.2893293768
## 48  1.246255      0.47  0.96532831 0.2809264056
## 49  1.237667      0.48  0.96683520 0.2708314010
## 50  1.227501      0.49  0.96937399 0.2581270566
## 51  1.217498      0.50  0.97128391 0.2462143416
## 52  1.209378      0.51  0.97408717 0.2352904954
## 53  1.201600      0.52  0.97586324 0.2257369595
## 54  1.194663      0.53  0.97803965 0.2166232054
## 55  1.188484      0.54  0.97995892 0.2085247657
## 56  1.181933      0.55  0.98181203 0.2001207422
## 57  1.172051      0.56  0.98290050 0.1891500474
## 58  1.166986      0.57  0.98447546 0.1825104543
## 59  1.161710      0.58  0.98584623 0.1758635743
## 60  1.151561      0.59  0.98754143 0.1640197833
## 61  1.144540      0.60  0.98897092 0.1555691450
## 62  1.136847      0.61  0.99033025 0.1465171714
## 63  1.129564      0.62  0.99163678 0.1379269467
## 64  1.123764      0.63  0.99266143 0.1311021410
## 65  1.118705      0.64  0.99361205 0.1250931499
## 66  1.116343      0.65  0.99442368 0.1219189654
## 67  1.111839      0.66  0.99510135 0.1167372546
## 68  1.104884      0.67  0.99557862 0.1093054758
## 69  1.101382      0.68  0.99632571 0.1050558275
## 70  1.097847      0.69  0.99693942 0.1009079029
## 71  1.092309      0.70  0.99720677 0.0951024170
## 72  1.087224      0.71  0.99755163 0.0896719782
## 73  1.081921      0.72  0.99782361 0.0840975133
## 74  1.076301      0.73  0.99809693 0.0782042477
## 75  1.068755      0.74  0.99843429 0.0703203494
## 76  1.060944      0.75  0.99856946 0.0623740672
## 77  1.054734      0.76  0.99877759 0.0559568445
## 78  1.048156      0.77  0.99891274 0.0492429634
## 79  1.043896      0.78  0.99911396 0.0447821331
## 80  1.037399      0.79  0.99958561 0.0378130625
## 81  1.030824      0.80  0.99965273 0.0311716465
## 82  1.023298      0.81  0.99979137 0.0235070196
## 83  1.019532      0.82  0.99986155 0.0196699574
## 84  1.013718      0.83  1.00000000 0.0137178941
## 85  1.010394      0.84  1.00000000 0.0103935772
## 86  1.007964      0.85  1.00000000 0.0079643730
## 87  1.005533      0.86  1.00000000 0.0055331786
## 88  1.004140      0.87  1.00000000 0.0041402898
## 89  1.002842      0.88  1.00000000 0.0028416366
## 90  1.002254      0.89  1.00000000 0.0022539061
## 91  1.001286      0.90  1.00000000 0.0012856521
## 92  1.000673      0.91  1.00000000 0.0006726964
## 93  1.000000      0.92  1.00000000 0.0000000000
## 94  1.000000      0.93  1.00000000 0.0000000000
## 95  1.000000      0.94  1.00000000 0.0000000000
## 96  1.000000      0.95  1.00000000 0.0000000000
## 97  1.000000      0.96  1.00000000 0.0000000000
## 98  1.000000      0.97  1.00000000 0.0000000000
## 99  1.000000      0.98  1.00000000 0.0000000000
## 100 1.000000      0.99  1.00000000 0.0000000000
## 101 1.000000      1.00  1.00000000 0.0000000000</code></pre>
<pre class="r"><code># this works but it does not show a group name
p = ggplot() + 
  geom_line(data = dfTestingResults, aes(x = Threshold, y = MeanSpec), color = &quot;blue&quot;) +
  geom_line(data = dfTestingResults, aes(x = Threshold, y = MeanSens), color = &quot;red&quot;) +
  geom_line(data = dfTestingResults, aes(x = Threshold, y = Sum), color = &quot;green&quot;) +
  xlab(&#39;Dates&#39;) +
  ylab(&#39;percent.change&#39;) + theme_economist()
p</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-35-5.png" width="672" /></p>
<pre class="r"><code>dfMeltThresholdData &lt;- melt(dfTestingResults, id.vars=&quot;Threshold&quot;, value.name=&quot;value&quot;)
ggplot(dfMeltThresholdData, aes(x=Threshold, y=value, color=variable)) + 
  geom_point()</code></pre>
<p><img src="EmployeeAttritionCaseStudy_files/figure-html/unnamed-chunk-35-6.png" width="672" /></p>
<pre class="r"><code>str(train)</code></pre>
<pre><code>## &#39;data.frame&#39;:    870 obs. of  44 variables:
##  $ ID                          : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Age                         : int  32 40 35 32 24 27 41 37 34 34 ...
##  $ Attrition                   : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ BusinessTravel              : Factor w/ 3 levels &quot;Non-Travel&quot;,&quot;Travel_Frequently&quot;,..: 3 3 2 3 2 2 3 3 3 2 ...
##  $ DailyRate                   : int  117 1308 200 801 567 294 1283 309 1333 653 ...
##  $ Department                  : Factor w/ 3 levels &quot;Human Resources&quot;,..: 3 2 2 3 2 2 2 3 3 2 ...
##  $ DistanceFromHome            : int  13 14 18 1 2 10 5 10 10 10 ...
##  $ Education                   : Factor w/ 5 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 4 3 2 4 1 2 5 4 4 4 ...
##  $ EducationField              : Factor w/ 6 levels &quot;Human Resources&quot;,..: 2 4 2 3 6 2 4 2 2 6 ...
##  $ EmployeeCount               : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ EmployeeNumber              : int  859 1128 1412 2016 1646 733 1448 1105 1055 1597 ...
##  $ EnvironmentSatisfaction     : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 2 3 3 3 1 4 2 4 3 4 ...
##  $ Gender                      : Factor w/ 2 levels &quot;Female&quot;,&quot;Male&quot;: 2 2 2 1 1 2 2 1 1 2 ...
##  $ HourlyRate                  : int  73 44 60 48 32 32 90 88 87 92 ...
##  $ JobInvolvement              : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 3 2 3 3 3 3 4 2 3 2 ...
##  $ JobLevel                    : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 3 2 3 3 3 3 4 2 3 2 ...
##  $ JobRole                     : Factor w/ 9 levels &quot;Healthcare Representative&quot;,..: 8 6 5 8 7 5 7 8 9 1 ...
##  $ JobSatisfaction             : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 4 3 4 4 4 1 3 4 3 3 ...
##  $ MaritalStatus               : Factor w/ 3 levels &quot;Divorced&quot;,&quot;Married&quot;,..: 1 3 3 2 3 1 2 1 2 2 ...
##  $ MonthlyIncome               : int  4403 19626 9362 10422 3760 8793 2127 6694 2220 5063 ...
##  $ MonthlyRate                 : int  9250 17544 19944 24032 17218 4809 5561 24223 18410 15332 ...
##  $ NumCompaniesWorked          : int  2 1 2 1 1 1 2 2 1 1 ...
##  $ Over18                      : Factor w/ 1 level &quot;Y&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ OverTime                    : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 2 1 2 2 2 1 ...
##  $ PercentSalaryHike           : int  11 14 11 19 13 21 12 14 19 14 ...
##  $ PerformanceRating           : Factor w/ 2 levels &quot;3&quot;,&quot;4&quot;: 1 1 1 1 1 2 1 1 1 1 ...
##  $ RelationshipSatisfaction    : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 3 1 3 3 3 3 1 3 4 2 ...
##  $ StandardHours               : int  80 80 80 80 80 80 80 80 80 80 ...
##  $ StockOptionLevel            : Factor w/ 4 levels &quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 2 1 1 3 1 3 1 4 2 2 ...
##  $ TotalWorkingYears           : int  8 21 10 14 6 9 7 8 1 8 ...
##  $ TrainingTimesLastYear       : int  3 2 2 3 2 4 5 5 2 3 ...
##  $ WorkLifeBalance             : Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 2 4 3 3 3 2 2 3 3 2 ...
##  $ YearsAtCompany              : int  5 20 2 14 6 9 4 1 1 8 ...
##  $ YearsInCurrentRole          : int  2 7 2 10 3 7 2 0 1 2 ...
##  $ YearsSinceLastPromotion     : int  0 4 2 5 1 1 0 0 0 7 ...
##  $ YearsWithCurrManager        : int  3 9 2 7 3 7 3 0 0 7 ...
##  $ BusinessTravelFrequently    : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 1 2 2 1 1 1 2 ...
##  $ LowEducation                : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 1 2 2 2 ...
##  $ LowEnvironmentalSatisfaction: Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 1 2 1 2 1 ...
##  $ LowJobLevel                 : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 2 1 2 1 2 1 ...
##  $ JobRoleSales                : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 2 1 ...
##  $ HighCompaniesWorked         : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ LowWorkLifeBalance          : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ JobRoleMed                  : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 1 1 2 2 1 2 2 1 1 ...</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
